                              1 ;
                              2 ; VCP200 circuit
                              3 ;
                              4 ; PB0 - 8 - GO/NO-ON 
                              5 ; PB1 - 9 - TURN RIGHT/YES-OFF
                              6 ; PB2 - 10 - REVERSE/NOT SURE
                              7 ; PB3 - 11 - SLOW
                              8 ; PB4 - 12 - STOP
                              9 ; PB5 - 13 - TAXI or RESET
                             10 ; PB6 - 14 - LEFT TURN
                             11 ; PB7 - 15 - BUCKETS or LIGHTS
                             12 ; TIMER - 7 - DATA IN 
                             13 ; PA7 - 19 - MODE - high = Yes/No/On/Off mode
                             14 ; PA6 - 18 - grounded; do middle part of special mode
                             15 ; PA5 - 17 - Vcc
                             16 ; PA4 - 16 - Vcc
                             17 ; ~IRQ - 2 - Hardwired to + (unused)
                             18 ; 10 Mhz Xtal
                             19 ;
                             20 
                             21 ; MC6804P2 Data Space Defines
                             22 
                     0000    23 PORTA   .equ    0x00
                     0001    24 PORTB   .equ    0x01
                     0004    25 DDRA    .equ    0x04
                     0005    26 DDRB    .equ    0x05
                             27 
                     0009    28 TSTATUS .equ    0x09
                             29 
                     005D    30 ROM5D   .equ    0x5D
                     005E    31 ROM5E   .equ    0x5E
                     005F    32 ROM5F   .equ    0x5F
                             33 
                     0080    34 X       .equ    0x80
                     0081    35 Y       .equ    0x81
                     0082    36 V       .equ    0x82
                     0083    37 W       .equ    0x83
                     0084    38 RAM84   .equ    0x84
                             39 
                     0085    40 FCNT    .equ    0x85
                     0086    41 VCNT    .equ    0x86
                     0087    42 SCNT    .equ    0x87
                             43 
                     0088    44 RAM88   .equ    0x88        ; N?
                     0089    45 RAM89   .equ    0x89
                     008A    46 RAM8A   .equ    0x8A
                     008B    47 RAM8B   .equ    0x8B
                     008C    48 RAM8C   .equ    0x8C
                     008D    49 RAM8D   .equ    0x8D
                     008E    50 RAM8E   .equ    0x8E
                     008F    51 RAM8F   .equ    0x8F
                     0090    52 RAM90   .equ    0x90
                     0091    53 RAM91   .equ    0x91
                     0092    54 RAM92   .equ    0x92
                             55 
                     009E    56 RAM9E   .equ    0x9E
                     009F    57 RAM9F   .equ    0x9F
                             58 
                     00FD    59 PRESCALE    .equ    0xFD
                     00FE    60 TCOUNT  .equ    0xFE
                     00FF    61 A       .equ    0xFF
                             62 
                             63         ; VCP200 - Program ROM
                             64 
                             65         .area   CODE1   (ABS)
                             66 
                             67         ; Self-test ROM area start
   0AE0                      68         .org    0x0ae0
                             69 
   0AE0                      70 L0AE0:
   0AE0 65            [ 2]   71         BCS     L0AE6
   0AE1 8A E6         [ 4]   72         JSR     L0AE6
   0AE3 EA 00         [ 4]   73         ADD     #0x00
   0AE5 B3            [ 2]   74         RTS
                             75 
   0AE6                      76 L0AE6:
   0AE6 F9 9E         [ 4]   77         STA     RAM9E
   0AE8 B4            [ 4]   78         COMA 
   0AE9 F5            [ 4]   79         AND     ,Y
   0AEA B4            [ 4]   80         COMA 
   0AEB F9 9F         [ 4]   81         STA     RAM9F
   0AED F0            [ 4]   82         LDA     ,Y
   0AEE B4            [ 4]   83         COMA 
   0AEF FD 9E         [ 4]   84         AND     RAM9E
   0AF1 B4            [ 4]   85         COMA 
   0AF2 FD 9F         [ 4]   86         AND     RAM9F
   0AF4 B4            [ 4]   87         COMA 
   0AF5 B3            [ 2]   88         RTS
                             89 
                             90 ; SELF-TEST START
                             91 
   0AF6                      92 SELFTST:
                             93 
   0AF6 B0 83 04      [ 4]   94         MVI     W,#0x04	        ; 0x04 -> W register
   0AF9                      95 L0AF9:
   0AF9 3F            [ 2]   96         BEQ     L0AF9           ; ???
   0AFA                      97 L0AFA:
   0AFA 7F            [ 2]   98         BCS     L0AFA           ; ???
   0AFB E8 00         [ 4]   99         LDA     #0x00           ; A = 0
   0AFD F9 00         [ 4]  100         STA     PORTA           ; Clear PORTA
   0AFF DF 04         [ 4]  101         BSET    #7,DDRA         ; Set PA7 As OUTPUT
                            102 
                            103 ; Stack Test
                            104 
                            105 ; JSR 4 times
   0B01 BE            [ 4]  106         STA     V               ; Clear V Register
   0B02                     107 L0B02:
   0B02 CA 82 03      [ 5]  108         BRSET   #2,V,L0B08      ; exit if V == 4
   0B05 AA            [ 4]  109         INC     V               ; V = V + 1
   0B06 8B 02         [ 4]  110         JSR     L0B02           ; add a stack level
                            111 
                            112 ; RTS 5 times
   0B08                     113 L0B08:
   0B08 CF 82 02      [ 5]  114         BRSET   #7,V,L0B0D      ; Exit if V == -1
   0B0B BA            [ 4]  115         DEC     V               ; V = V - 1
   0B0C B3            [ 2]  116         RTS
   0B0D                     117 L0B0D:
   0B0D 8B FF         [ 4]  118         JSR     L0BFF           ; A=0, Clear interrupt mask?
   0B0F                     119 L0B0F:
   0B0F C9 09 FD      [ 5]  120         BRSET   #1,0x09,L0B0F   ; wait for timer?
                            121 
   0B12 68            [ 2]  122         BCS     L0B1B
   0B13 E8 06         [ 4]  123         LDA     #0x06           ; DDRC into X
   0B15 BC            [ 4]  124         STA     X
   0B16 EB 04         [ 4]  125         SUB     #0x04           ; DDRA into Y
   0B18 BD            [ 4]  126         STA     Y
   0B19                     127 L0B19:
   0B19 E8 0F         [ 4]  128         LDA     #0x0F
   0B1B                     129 L0B1B:
   0B1B F9 84         [ 4]  130         STA     RAM84           ; 0x0F into $84
   0B1D AE            [ 4]  131         LDA     V               ; Put V into DDRA (should be 0xff)
   0B1E F1            [ 4]  132         STA     ,Y              ; Select PORTA as all outputs
   0B1F FD 84         [ 4]  133         AND     RAM84           ; A = 0x0F
   0B21 E1            [ 4]  134         STA     ,X              ; Select PC0-PC3 as all outputs
   0B22 AE            [ 4]  135         LDA     V
   0B23                     136 L0B23:
   0B23 F1            [ 4]  137         STA     ,Y              ; Select PORTA as all outputs, again
   0B24 FC FF         [ 4]  138         CMP     0xFF            ; All outputs?
   0B26                     139 L0B26:
   0B26 7F            [ 2]  140         BCS     L0B26           ; 
   0B27 DB 01         [ 4]  141         BSET    #3,PORTB        ; Set PB3 HIGH - nIRQ
   0B29 DE 00         [ 4]  142         BSET    #6,PORTA        ; Set PA6 as Output - turn on LED
   0B2B D2 02         [ 4]  143         BCLR    #2,0x02         ; Set PC2 LOW - no effect
   0B2D F4            [ 4]  144         CMP     ,Y              ; DDRA all outputs?
   0B2E B4            [ 4]  145         COMA                    ; A = 0xff
   0B2F 33            [ 2]  146         BEQ     L0B23
   0B30 E0            [ 4]  147         LDA     ,X
   0B31 B4            [ 4]  148         COMA 
   0B32 CF FF E6      [ 5]  149         BRSET   #7,0xFF,L0B1B
   0B35 ED 00         [ 4]  150         AND     #0x00
   0B37 E1            [ 4]  151         STA     ,X
   0B38 B8            [ 4]  152         DEC     X
   0B39 B9            [ 4]  153         DEC     Y
   0B3A C5 81 DC      [ 5]  154         BRCLR   #5,Y,L0B19
                            155 
   0B3D E8 0F         [ 4]  156         LDA     #0x0F
   0B3F F9 05         [ 4]  157         STA     DDRB            ; PB0-PB3 as outputs
   0B41 FB 0A         [ 4]  158         SUB     0x0A
   0B43 EB EE         [ 4]  159         SUB     #0xEE
   0B45                     160 L0B45:
   0B45 1F            [ 2]  161         BNE     L0B45
   0B46 F8 0B         [ 4]  162         LDA     0x0B
   0B48 EC 1B         [ 4]  163         CMP     #0x1B
   0B4A                     164 L0B4A:
   0B4A 1F            [ 2]  165         BNE     L0B4A
                            166 
   0B4B FE 01         [ 4]  167         INC     PORTB           ; PB0-PB3 -> 1
   0B4D 8B 5E         [ 4]  168         JSR     L0B5E           ; Do Ram Clear
   0B4F FA 0A         [ 4]  169         ADD     0x0A
   0B51 EC 32         [ 4]  170         CMP     #0x32
   0B53                     171 L0B53:
   0B53 1F            [ 2]  172         BNE     L0B53
   0B54 F8 0B         [ 4]  173         LDA     0x0B
   0B56 EC BB         [ 4]  174         CMP     #0xBB
   0B58                     175 L0B58:
   0B58 1F            [ 2]  176         BNE     L0B58
   0B59 FE 01         [ 4]  177         INC     PORTB           ; PB0-PB3 -> 2
   0B5B FE 01         [ 4]  178         INC     PORTB           ; PB0-PB3 -> 3
   0B5D                     179 L0B5D:
   0B5D 1F            [ 2]  180         BNE     L0B5D
                            181 
                            182 ; RAM clear, from $82-$9F
                            183 
   0B5E                     184 L0B5E:
   0B5E E8 FF         [ 4]  185         LDA     #0xFF
   0B60 B4            [ 4]  186         COMA
   0B61                     187 L0B61:
   0B61 1F            [ 2]  188         BNE     L0B61
   0B62 8B CC         [ 4]  189         JSR     L0BCC
   0B64                     190 L0B64:
   0B64 1F            [ 2]  191         BNE     L0B64
   0B65                     192 L0B65:
   0B65 F1            [ 4]  193         STA     ,Y              ; Clear [Y]
   0B66 B5            [ 4]  194         ROLA
   0B67 B9            [ 4]  195         DEC     Y
   0B68 B8            [ 4]  196         DEC     X
   0B69 1B            [ 2]  197         BNE     L0B65
                            198 
                            199 ; RAM tests
                            200 
   0B6A E8 55         [ 4]  201         LDA     #0x55
   0B6C                     202 L0B6C:
   0B6C 8B CC         [ 4]  203         JSR     L0BCC
   0B6E F7            [ 4]  204         DEC     ,Y
   0B6F                     205 L0B6F:
   0B6F F4            [ 4]  206         CMP     ,Y
   0B70 F1            [ 4]  207         STA     ,Y
   0B71 B4            [ 4]  208         COMA 
   0B72 B9            [ 4]  209         DEC     Y
   0B73 B8            [ 4]  210         DEC     X
   0B74 1A            [ 2]  211         BNE     L0B6F
   0B75 FA FF         [ 4]  212         ADD     A
   0B77 54            [ 2]  213         BCC     L0B6C
   0B78 FB FF         [ 4]  214         SUB     A
   0B7A                     215 L0B7A:
   0B7A 7F            [ 2]  216         BCS     L0B7A
                            217 
   0B7B 8B CC         [ 4]  218         JSR     L0BCC
   0B7D                     219 L0B7D:
   0B7D F4            [ 4]  220         CMP     ,Y
   0B7E F1            [ 4]  221         STA     ,Y
   0B7F B9            [ 4]  222         DEC     Y
   0B80 B8            [ 4]  223         DEC     X
   0B81 1B            [ 2]  224         BNE     L0B7D
   0B82 A8            [ 4]  225         INC     X
   0B83 FA 0A         [ 4]  226         ADD     0x0A
   0B85 EC 3B         [ 4]  227         CMP     #0x3B
   0B87                     228 L0B87:
   0B87 1F            [ 2]  229         BNE     L0B87
   0B88 FA 0B         [ 4]  230         ADD     0x0B
   0B8A EC A1         [ 4]  231         CMP     #0xA1
   0B8C                     232 L0B8C:
   0B8C 1F            [ 2]  233         BNE     L0B8C
   0B8D E6            [ 4]  234         INC     ,X
                            235 
   0B8E D0 05         [ 4]  236         BCLR    #0,DDRB     ; PB0 Low
                            237 
                            238 ; Timer Test
                            239 
   0B90 B0 09 28      [ 4]  240         MVI     TSTATUS,#0x28
   0B93                     241 L0B93:
   0B93 F8 FD         [ 4]  242         LDA     PRESCALE
   0B95 E0            [ 4]  243         LDA     ,X
   0B96 C7 09 FA      [ 5]  244         BRCLR   #7,TSTATUS,L0B93
   0B99 E3            [ 4]  245         SUB     ,X
   0B9A 30            [ 2]  246         BEQ     L0B8C-1                     ; ???
   0B9B DC 09         [ 4]  247         BSET    #4,TSTATUS
   0B9D B0 FE 06      [ 4]  248         MVI     TCOUNT,#0x06
   0BA0                     249 L0BA0:
   0BA0 C0 01 FD      [ 5]  250         BRCLR   #0,PORTB,L0BA0
   0BA3 D4 09         [ 4]  251         BCLR    #4,TSTATUS
   0BA5                     252 L0BA5:
   0BA5 CF 09 FD      [ 5]  253         BRSET   #7,TSTATUS,L0BA5
   0BA8                     254 L0BA8:
   0BA8 B0 FE 04      [ 4]  255         MVI     TCOUNT,#0x04
   0BAB D7 09         [ 4]  256         BCLR    #7,TSTATUS
   0BAD D8 05         [ 4]  257         BSET    #0,DDRB     ; PB0 High
   0BAF D5 09         [ 4]  258         BCLR    #5,TSTATUS
   0BB1 D4 FF         [ 4]  259         BCLR    #4,A
   0BB3 33            [ 2]  260         BEQ     L0BA8-1                     ; ???
   0BB4 32            [ 2]  261         BEQ     L0BA8-1                     ; ???
   0BB5 F9 FE         [ 4]  262         STA     TCOUNT
   0BB7 E6            [ 4]  263         INC     ,X
   0BB8                     264 L0BB8:
   0BB8 D0 FD         [ 4]  265         BCLR    #0,PRESCALE
   0BBA                     266 L0BBA:
   0BBA C7 09 FD      [ 5]  267         BRCLR   #7,TSTATUS,L0BBA
   0BBD FE 09         [ 4]  268         INC     TSTATUS
   0BBF FE FE         [ 4]  269         INC     TCOUNT
   0BC1 F9 FD         [ 4]  270         STA     PRESCALE
   0BC3 FA FF         [ 4]  271         ADD     A
   0BC5 52            [ 2]  272         BCC     L0BB8
                            273 
   0BC6 AE            [ 4]  274         LDA     V
   0BC7 B8            [ 4]  275         DEC     X
   0BC8                     276 L0BC8:
   0BC8 E2            [ 4]  277         ADD     ,X
   0BC9 A8            [ 4]  278         INC     X
   0BCA 1D            [ 2]  279         BNE     L0BC8
   0BCB B3            [ 2]  280         RTS 
                            281 
   0BCC                     282 L0BCC:
   0BCC B0 80 1E      [ 4]  283         MVI     X,#0x1E         ; #0x1E -> X (number of bytes)
   0BCF B0 81 9F      [ 4]  284         MVI     Y,#0x9F         ; #0x9F -> Y (last ram location)
   0BD2 B3            [ 2]  285         RTS
   0BD3                     286 L0BD3:
   0BD3 C2 83 0C      [ 5]  287         BRCLR   #2,W,L0BE2
   0BD6                     288 L0BD6:
   0BD6 D7 00         [ 4]  289         BCLR    #7,PORTA        ; Clear PA7
   0BD8 DB 01         [ 4]  290         BSET    #3,PORTB        ; Set PB3
   0BDA DF FF         [ 4]  291         BSET    #7,A
   0BDC 8A E0         [ 4]  292         JSR     L0AE0
   0BDE F1            [ 4]  293         STA     ,Y
   0BDF                     294 L0BDF:
   0BDF 5F            [ 2]  295         BCC     L0BDF
   0BE0 BB            [ 4]  296         DEC     W
   0BE1 31            [ 2]  297         BEQ     L0BD3
   0BE2                     298 L0BE2:
   0BE2 B2            [ 2]  299         RTI 
                            300 
                            301 ; SELF TEST IRQ HANDLER ENTRY
                            302 
   0BE3                     303 SELFIRQ:
                            304 
   0BE3 72            [ 2]  305         BCS     L0BD6
   0BE4 25            [ 2]  306         BEQ     L0BEA
   0BE5 D7 04         [ 4]  307         BCLR    #7,DDRA
   0BE7 C8 FE F5      [ 5]  308         BRSET   #0,TCOUNT,L0BDF
   0BEA                     309 L0BEA:
   0BEA B0 80 02      [ 4]  310         MVI     X,#0x02
   0BED B0 09 27      [ 4]  311         MVI     TSTATUS,#0x27
   0BF0 AF            [ 4]  312         LDA     W
   0BF1 B4            [ 4]  313         COMA 
   0BF2 25            [ 2]  314         BEQ     L0BF8
   0BF3 B0 80 06      [ 4]  315         MVI     X,#0x06
   0BF6 DC 09         [ 4]  316         BSET    #4,TSTATUS
   0BF8                     317 L0BF8:
   0BF8 DF 09         [ 4]  318         BSET    #7,TSTATUS
   0BFA                     319 L0BFA:
   0BFA E1            [ 4]  320         STA     ,X
   0BFB B8            [ 4]  321         DEC     X
   0BFC 1D            [ 2]  322         BNE     L0BFA
   0BFD E1            [ 4]  323         STA     ,X
   0BFE BF            [ 4]  324         STA     W
   0BFF                     325 L0BFF:
   0BFF FB FF         [ 4]  326         SUB     A          ; Clear A
   0C01 B2            [ 2]  327         RTI
                            328 
                            329 
   0C02 4D 43 36 38 30 34   330         .ASCII  'MC6804J2 - ATX'
        4A 32 20 2D 20 41
        54 58
                            331 ;
                            332 ; VCP200 - USER PROGRAM START
                            333 ;
                            334 
   0C10                     335 START:
                            336 
                            337 ; Init pins
   0C10 B0 05 FF      [ 4]  338         MVI     DDRB,#0xFF      ; Port B - all outputs
   0C13 B0 01 FE      [ 4]  339         MVI     PORTB,#0xFE
   0C16 B0 04 00      [ 4]  340         MVI     DDRA,#0x00      ; Port A - all inputs
                            341 
                            342 ; Init RAM
   0C19 D1 82         [ 4]  343         BCLR    #1,V            ; clear test bit??
                            344 ; Main loop
   0C1B                     345 L0C1B:
                            346         ; clear RAM from $83 to $9F
   0C1B B0 81 1D      [ 4]  347         MVI     Y,#0x1D
   0C1E B0 80 83      [ 4]  348         MVI     X,#0x83
   0C21 E8 00         [ 4]  349         LDA     #0x00
   0C23                     350 RAMCLR:
   0C23 E1            [ 4]  351         STA     ,X
   0C24 A8            [ 4]  352         INC     X
   0C25 B9            [ 4]  353         DEC     Y
   0C26 1C            [ 2]  354         BNE     RAMCLR
                            355 
   0C27 B0 81 93      [ 4]  356         MVI     Y,#0x93         ; Y points to 0x93
   0C2A                     357 L0C2A:
   0C2A E8 00         [ 4]  358         LDA     #0x00
   0C2C F9 85         [ 4]  359         STA     FCNT
   0C2E F9 86         [ 4]  360         STA     VCNT
   0C30 F9 87         [ 4]  361         STA     SCNT
   0C32 8F C7         [ 4]  362         JSR     L0FC7           ; Read and classify frames?
   0C34 C1 82 02      [ 5]  363         BRCLR   #1,V,L0C39
                            364 
   0C37 9D 14         [ 4]  365         JMP     L0D14
   0C39                     366 L0C39:
   0C39 B0 01 80      [ 4]  367         MVI     PORTB,#0x80     ; 1000 0000
   0C3C F8 00         [ 4]  368         LDA     PORTA           ; check PORTA upper nibble
   0C3E ED F0         [ 4]  369         AND     #0xF0
   0C40 EC F0         [ 4]  370         CMP     #0xF0
   0C42 02            [ 2]  371         BNE     L0C45           ; always jump because PA6 is grounded?
   0C43 9D 14         [ 4]  372         JMP     L0D14           ; PORTA is 1111 - unknown mode jump?
                            373 
                            374 ; Try to decode Normal mode or Special modes
   0C45                     375 L0C45:
   0C45 D1 82         [ 4]  376         BCLR    #1,V
   0C47 B0 01 FC      [ 4]  377         MVI     PORTB,#0xFC     ; 1111 1100
   0C4A CC 00 05      [ 5]  378         BRSET   #4,PORTA,L0C52  ; should be high
   0C4D B0 88 DC      [ 4]  379         MVI     RAM88,#0xDC
   0C50 9C FD         [ 4]  380         JMP     L0CFD           ; PORTA is XXX0 - secret code 0xdc?
   0C52                     381 L0C52:
   0C52 CD 00 05      [ 5]  382         BRSET   #5,PORTA,L0C5A  ; should be high
   0C55 B0 88 74      [ 4]  383         MVI     RAM88,#0x74
   0C58 9C FD         [ 4]  384         JMP     L0CFD           ; PORTA is XX01 - secret code 0x74?
   0C5A                     385 L0C5A:
   0C5A CE 00 07      [ 5]  386         BRSET   #6,PORTA,L0C64  ; should be low
   0C5D D9 82         [ 4]  387         BSET    #1,V
   0C5F B0 01 FF      [ 4]  388         MVI     PORTB,#0xFF     ; 1111 1111
   0C62 9D 14         [ 4]  389         JMP     L0D14           ; PORTA is X011 - normal mode
   0C64                     390 L0C64:
   0C64 CF 00 05      [ 5]  391         BRSET   #7,PORTA,L0C6C  ;
   0C67 B0 88 78      [ 4]  392         MVI     RAM88,#0x78
   0C6A 9C FD         [ 4]  393         JMP     L0CFD           ; PORTA is 0111 - secret code 0x78?
                            394 
   0C6C                     395 L0C6C:
   0C6C B0 01 FA      [ 4]  396         MVI     PORTB,#0xFA     ; PORTA is 1111 - 1111 1010
   0C6F CC 00 05      [ 5]  397         BRSET   #4,PORTA,L0C77     
   0C72 B0 88 D8      [ 4]  398         MVI     RAM88,#0xD8
   0C75 9C FD         [ 4]  399         JMP     L0CFD           ; secret code 0xd8?
   0C77                     400 L0C77:
   0C77 CD 00 05      [ 5]  401         BRSET   #5,PORTA,L0C7F
   0C7A B0 88 BC      [ 4]  402         MVI     RAM88,#0xBC         
   0C7D 9C FD         [ 4]  403         JMP     L0CFD           ; secret code 0xbc?
   0C7F                     404 L0C7F:
   0C7F CE 00 05      [ 5]  405         BRSET   #6,PORTA,L0C87
   0C82 B0 88 EC      [ 4]  406         MVI     RAM88,#0xEC
   0C85 9C FD         [ 4]  407         JMP     L0CFD           ; secret code 0xec?
                            408 
   0C87                     409 L0C87:
   0C87 B0 01 F6      [ 4]  410         MVI     PORTB,#0xF6     ; 1111 0110
   0C8A CD 00 05      [ 5]  411         BRSET   #5,PORTA,L0C92
   0C8D B0 88 B8      [ 4]  412         MVI     RAM88,#0xB8
   0C90 9C FD         [ 4]  413         JMP     L0CFD           ; secret code 0xb8?
   0C92                     414 L0C92:
   0C92 CE 00 05      [ 5]  415         BRSET   #6,PORTA,L0C9A
   0C95 B0 88 E8      [ 4]  416         MVI     RAM88,#0xE8
   0C98 9C FD         [ 4]  417         JMP     L0CFD           ; secret code 0xe8?
   0C9A                     418 L0C9A:
   0C9A CF 00 05      [ 5]  419         BRSET   #7,PORTA,L0CA2
   0C9D B0 88 FC      [ 4]  420         MVI     RAM88,#0xFC
   0CA0 9C FD         [ 4]  421         JMP     L0CFD           ; secret code 0xfc?
                            422 
   0CA2                     423 L0CA2:
   0CA2 B0 01 EE      [ 4]  424         MVI     PORTB,#0xEE     ; 1110 1110
   0CA5 CD 00 05      [ 5]  425         BRSET   #5,PORTA,L0CAD
   0CA8 B0 88 B4      [ 4]  426         MVI     RAM88,#0xB4
   0CAB 9C FD         [ 4]  427         JMP     L0CFD           ; secret code 0xb4?
   0CAD                     428 L0CAD:
   0CAD CE 00 05      [ 5]  429         BRSET   #6,PORTA,L0CB5
   0CB0 B0 88 E4      [ 4]  430         MVI     RAM88,#0xE4
   0CB3 9C FD         [ 4]  431         JMP     L0CFD           ; secret code 0xe4?
   0CB5                     432 L0CB5:
   0CB5 CF 00 05      [ 5]  433         BRSET   #7,PORTA,L0CBD
   0CB8 B0 88 F4      [ 4]  434         MVI     RAM88,#0xF4
   0CBB 9C FD         [ 4]  435         JMP     L0CFD           ; secret code 0xf4?
                            436 
   0CBD                     437 L0CBD:
   0CBD B0 01 DE      [ 4]  438         MVI     PORTB,#0xDE     ; 1101 1110
   0CC0 CC 00 05      [ 5]  439         BRSET   #4,PORTA,L0CC8
   0CC3 B0 88 F8      [ 4]  440         MVI     RAM88,#0xF8
   0CC6 9C FD         [ 4]  441         JMP     L0CFD           ; secret code 0xf8?
   0CC8                     442 L0CC8:
   0CC8 CD 00 05      [ 5]  443         BRSET   #5,PORTA,L0CD0
   0CCB B0 88 70      [ 4]  444         MVI     RAM88,#0x70
   0CCE 9C FD         [ 4]  445         JMP     L0CFD           ; secret code 0x70?
   0CD0                     446 L0CD0:
   0CD0 CE 00 05      [ 5]  447         BRSET   #6,PORTA,L0CD8
   0CD3 B0 88 E0      [ 4]  448         MVI     RAM88,#0xE0
   0CD6 9C FD         [ 4]  449         JMP     L0CFD           ; secret code 0xe0?
   0CD8                     450 L0CD8:
   0CD8 CF 00 05      [ 5]  451         BRSET   #7,PORTA,L0CE0
   0CDB B0 88 F0      [ 4]  452         MVI     RAM88,#0xF0
   0CDE 9C FD         [ 4]  453         JMP     L0CFD           ; secret code 0xf0?
                            454 
   0CE0                     455 L0CE0:
   0CE0 B0 01 BE      [ 4]  456         MVI     PORTB,#0xBE     ; 1011 1110
   0CE3 CC 00 05      [ 5]  457         BRSET   #4,PORTA,L0CEB
   0CE6 B0 88 D0      [ 4]  458         MVI     RAM88,#0xD0
   0CE9 9C FD         [ 4]  459         JMP     L0CFD           ; secret code 0xd0?
   0CEB                     460 L0CEB:
   0CEB CE 00 05      [ 5]  461         BRSET   #6,PORTA,L0CF3
   0CEE B0 88 7C      [ 4]  462         MVI     RAM88,#0x7C
   0CF1 9C FD         [ 4]  463         JMP     L0CFD           ; secret code 0x7c?
   0CF3                     464 L0CF3:
   0CF3 CF 00 05      [ 5]  465         BRSET   #7,PORTA,L0CFB
   0CF6 B0 88 D4      [ 4]  466         MVI     RAM88,#0xD4
   0CF9 9C FD         [ 4]  467         JMP     L0CFD           ; secret code 0xd4?
   0CFB                     468 L0CFB:
   0CFB 9D 14         [ 4]  469         JMP     L0D14
                            470 
                            471 ; do middle part of special mode
   0CFD                     472 L0CFD:
   0CFD 8F 7B         [ 4]  473         JSR     L0F7B           ; secret code trampoline
                            474 
                            475 ; do last part of special mode and go back to memory clear
                            476 
   0CFF B0 01 80      [ 4]  477         MVI     PORTB,#0x80     ; 1000 0000
   0D02                     478 L0D02:
   0D02 F8 00         [ 4]  479         LDA     PORTA           ; wait loop until PORTA = 1111
   0D04 ED F0         [ 4]  480         AND     #0xF0
   0D06 EC F0         [ 4]  481         CMP     #0xF0
   0D08 19            [ 2]  482         BNE     L0D02
   0D09 B0 FE 40      [ 4]  483         MVI     TCOUNT,#0x40
   0D0C B0 09 3F      [ 4]  484         MVI     TSTATUS,#0x3F
   0D0F                     485 L0D0F:
   0D0F C7 09 FD      [ 5]  486         BRCLR   #7,TSTATUS,L0D0F
   0D12 9C 1B         [ 4]  487         JMP     L0C1B
                            488 
                            489 ; Normal mode
                            490 
   0D14                     491 L0D14:
   0D14 F8 8B         [ 4]  492         LDA     RAM8B           ; Shift 0x88:8B -> 89:8C
   0D16 F9 8C         [ 4]  493         STA     RAM8C
   0D18 F8 8A         [ 4]  494         LDA     RAM8A
   0D1A F9 8B         [ 4]  495         STA     RAM8B
   0D1C F8 89         [ 4]  496         LDA     RAM89
   0D1E F9 8A         [ 4]  497         STA     RAM8A
   0D20 F8 88         [ 4]  498         LDA     RAM88
   0D22 F9 89         [ 4]  499         STA     RAM89
                            500 
   0D24 F8 85         [ 4]  501         LDA     FCNT
   0D26 FA 86         [ 4]  502         ADD     VCNT
   0D28 FA 87         [ 4]  503         ADD     SCNT
   0D2A EC 02         [ 4]  504         CMP     #0x02
   0D2C 45            [ 2]  505         BCC     L0D32
   0D2D B0 88 00      [ 4]  506         MVI     RAM88,#0x00
   0D30 9D 4C         [ 4]  507         JMP     L0D4C
   0D32                     508 L0D32:
   0D32 F8 87         [ 4]  509         LDA     SCNT
   0D34 EC 10         [ 4]  510         CMP     #0x10
   0D36 42            [ 2]  511         BCC     L0D39
   0D37 9D 49         [ 4]  512         JMP     L0D49
   0D39                     513 L0D39:
   0D39 FC 86         [ 4]  514         CMP     VCNT
   0D3B 65            [ 2]  515         BCS     L0D41
   0D3C B0 88 02      [ 4]  516         MVI     RAM88,#0x02
   0D3F 9D 4C         [ 4]  517         JMP     L0D4C
   0D41                     518 L0D41:
   0D41 F8 85         [ 4]  519         LDA     FCNT
   0D43 05            [ 2]  520         BNE     L0D49
   0D44 B0 88 02      [ 4]  521         MVI     RAM88,#0x02
   0D47 9D 4C         [ 4]  522         JMP     L0D4C
   0D49                     523 L0D49:
   0D49 B0 88 01      [ 4]  524         MVI     RAM88,#0x01
   0D4C                     525 L0D4C:
   0D4C B0 85 00      [ 4]  526         MVI     FCNT,#0x00
   0D4F B0 86 00      [ 4]  527         MVI     VCNT,#0x00
   0D52 B0 87 00      [ 4]  528         MVI     SCNT,#0x00
   0D55 E8 85         [ 4]  529         LDA     #0x85
   0D57 FA 88         [ 4]  530         ADD     RAM88
   0D59 BC            [ 4]  531         STA     X
   0D5A E6            [ 4]  532         INC     ,X
   0D5B E8 85         [ 4]  533         LDA     #0x85
   0D5D FA 89         [ 4]  534         ADD     RAM89
   0D5F BC            [ 4]  535         STA     X
   0D60 E6            [ 4]  536         INC     ,X
   0D61 E8 85         [ 4]  537         LDA     #0x85
   0D63 FA 8A         [ 4]  538         ADD     RAM8A
   0D65 BC            [ 4]  539         STA     X
   0D66 E6            [ 4]  540         INC     ,X
   0D67 E8 85         [ 4]  541         LDA     #0x85
   0D69 FA 8B         [ 4]  542         ADD     RAM8B
   0D6B BC            [ 4]  543         STA     X
   0D6C E6            [ 4]  544         INC     ,X
   0D6D E8 85         [ 4]  545         LDA     #0x85
   0D6F FA 8C         [ 4]  546         ADD     RAM8C
   0D71 BC            [ 4]  547         STA     X
   0D72 E6            [ 4]  548         INC     ,X
   0D73 F8 85         [ 4]  549         LDA     FCNT
   0D75 EC 02         [ 4]  550         CMP     #0x02
   0D77 65            [ 2]  551         BCS     L0D7D
   0D78 B0 92 00      [ 4]  552         MVI     RAM92,#0x00
   0D7B 9D 94         [ 4]  553         JMP     L0D94
   0D7D                     554 L0D7D:
   0D7D F8 86         [ 4]  555         LDA     VCNT
   0D7F EC 04         [ 4]  556         CMP     #0x04
   0D81 65            [ 2]  557         BCS     L0D87
   0D82 B0 92 01      [ 4]  558         MVI     RAM92,#0x01
   0D85 9D 94         [ 4]  559         JMP     L0D94
   0D87                     560 L0D87:
   0D87 F8 87         [ 4]  561         LDA     SCNT
   0D89 EC 03         [ 4]  562         CMP     #0x03
   0D8B 65            [ 2]  563         BCS     L0D91
   0D8C B0 92 02      [ 4]  564         MVI     RAM92,#0x02
   0D8F 9D 94         [ 4]  565         JMP     L0D94
   0D91                     566 L0D91:
   0D91 B0 92 80      [ 4]  567         MVI     RAM92,#0x80
   0D94                     568 L0D94:
   0D94 FE 8E         [ 4]  569         INC     RAM8E
   0D96                     570 L0D96:
   0D96 C7 92 02      [ 5]  571         BRCLR   #7,RAM92,L0D9B
   0D99 9C 2A         [ 4]  572         JMP     L0C2A
   0D9B                     573 L0D9B:
   0D9B F8 92         [ 4]  574         LDA     RAM92
   0D9D FC 8F         [ 4]  575         CMP     RAM8F
   0D9F 02            [ 2]  576         BNE     L0DA2
   0DA0 9E 08         [ 4]  577         JMP     L0E08
   0DA2                     578 L0DA2:
   0DA2 F8 8D         [ 4]  579         LDA     RAM8D
   0DA4 0C            [ 2]  580         BNE     L0DB1
   0DA5 F8 92         [ 4]  581         LDA     RAM92
   0DA7 F9 8F         [ 4]  582         STA     RAM8F
   0DA9 B0 8D 01      [ 4]  583         MVI     RAM8D,#0x01
   0DAC B0 90 01      [ 4]  584         MVI     RAM90,#0x01
   0DAF                     585 L0DAF:
   0DAF 9C 2A         [ 4]  586         JMP     L0C2A
   0DB1                     587 L0DB1:
   0DB1 F8 8F         [ 4]  588         LDA     RAM8F
   0DB3 2A            [ 2]  589         BEQ     L0DBE
   0DB4 EC 01         [ 4]  590         CMP     #0x01
   0DB6 02            [ 2]  591         BNE     L0DB9
   0DB7 9D F8         [ 4]  592         JMP     L0DF8
   0DB9                     593 L0DB9:
   0DB9 EC 02         [ 4]  594         CMP     #0x02
   0DBB 13            [ 2]  595         BNE     L0DAF
   0DBC 9E 01         [ 4]  596         JMP     L0E01
   0DBE                     597 L0DBE:
   0DBE F8 90         [ 4]  598         LDA     RAM90
   0DC0 EC 02         [ 4]  599         CMP     #0x02
   0DC2 62            [ 2]  600         BCS     L0DC5
   0DC3 9D D9         [ 4]  601         JMP     L0DD9
   0DC5                     602 L0DC5:
   0DC5 AD            [ 4]  603         LDA     Y
   0DC6 EC 93         [ 4]  604         CMP     #0x93
   0DC8 02            [ 2]  605         BNE     L0DCB
   0DC9 9C 1B         [ 4]  606         JMP     L0C1B
   0DCB                     607 L0DCB:
   0DCB B9            [ 4]  608         DEC     Y
   0DCC F0            [ 4]  609         LDA     ,Y
   0DCD ED 03         [ 4]  610         AND     #0x03
   0DCF F9 8F         [ 4]  611         STA     RAM8F
   0DD1 F8 91         [ 4]  612         LDA     RAM91
   0DD3 F9 90         [ 4]  613         STA     RAM90
   0DD5 FF 8D         [ 4]  614         DEC     RAM8D
   0DD7 9D 96         [ 4]  615         JMP     L0D96
   0DD9                     616 L0DD9:
   0DD9 F8 90         [ 4]  617         LDA     RAM90
   0DDB FA FF         [ 4]  618         ADD     A
   0DDD FA FF         [ 4]  619         ADD     A
   0DDF FA 8F         [ 4]  620         ADD     RAM8F
   0DE1 F1            [ 4]  621         STA     ,Y
   0DE2 A9            [ 4]  622         INC     Y
   0DE3 AD            [ 4]  623         LDA     Y
   0DE4 EC 9F         [ 4]  624         CMP     #0x9F
   0DE6 62            [ 2]  625         BCS     L0DE9
   0DE7 9C 1B         [ 4]  626         JMP     L0C1B
   0DE9                     627 L0DE9:
   0DE9 FE 8D         [ 4]  628         INC     RAM8D
   0DEB F8 92         [ 4]  629         LDA     RAM92
   0DED F9 8F         [ 4]  630         STA     RAM8F
   0DEF F8 90         [ 4]  631         LDA     RAM90
   0DF1 F9 91         [ 4]  632         STA     RAM91
   0DF3 B0 90 01      [ 4]  633         MVI     RAM90,#0x01
   0DF6 9C 2A         [ 4]  634         JMP     L0C2A
   0DF8                     635 L0DF8:
   0DF8 F8 90         [ 4]  636         LDA     RAM90
   0DFA EC 04         [ 4]  637         CMP     #0x04
   0DFC 42            [ 2]  638         BCC     L0DFF
   0DFD                     639 L0DFD:
   0DFD 9D C5         [ 4]  640         JMP     L0DC5
   0DFF                     641 L0DFF:
   0DFF 9D D9         [ 4]  642         JMP     L0DD9
   0E01                     643 L0E01:
   0E01 F8 90         [ 4]  644         LDA     RAM90
   0E03 EC 04         [ 4]  645         CMP     #0x04
   0E05 77            [ 2]  646         BCS     L0DFD
   0E06 9D D9         [ 4]  647         JMP     L0DD9
   0E08                     648 L0E08:
   0E08 F8 92         [ 4]  649         LDA     RAM92
   0E0A 2E            [ 2]  650         BEQ     L0E19
   0E0B FE 90         [ 4]  651         INC     RAM90
   0E0D F8 90         [ 4]  652         LDA     RAM90
   0E0F EC 3F         [ 4]  653         CMP     #0x3F
   0E11 63            [ 2]  654         BCS     L0E15
   0E12 B0 90 3F      [ 4]  655         MVI     RAM90,#0x3F
   0E15                     656 L0E15:
   0E15 9C 2A         [ 4]  657         JMP     L0C2A
   0E17                     658 L0E17:
   0E17 9C 1B         [ 4]  659         JMP     L0C1B
   0E19                     660 L0E19:
   0E19 FE 90         [ 4]  661         INC     RAM90
   0E1B F8 90         [ 4]  662         LDA     RAM90
   0E1D EC 18         [ 4]  663         CMP     #0x18
   0E1F 75            [ 2]  664         BCS     L0E15
   0E20 AD            [ 4]  665         LDA     Y
   0E21 EC 94         [ 4]  666         CMP     #0x94
   0E23 42            [ 2]  667         BCC     L0E26
   0E24 9E 17         [ 4]  668         JMP     L0E17
   0E26                     669 L0E26:
   0E26 EB 93         [ 4]  670         SUB     #0x93
   0E28 F9 8D         [ 4]  671         STA     RAM8D
   0E2A F9 8A         [ 4]  672         STA     RAM8A
   0E2C F8 8E         [ 4]  673         LDA     RAM8E
   0E2E EC 20         [ 4]  674         CMP     #0x20
   0E30 42            [ 2]  675         BCC     L0E33
   0E31 9E 17         [ 4]  676         JMP     L0E17
   0E33                     677 L0E33:
   0E33 B9            [ 4]  678         DEC     Y
   0E34 AD            [ 4]  679         LDA     Y
   0E35 EC 95         [ 4]  680         CMP     #0x95
   0E37 42            [ 2]  681         BCC     L0E3A
   0E38 9E 4A         [ 4]  682         JMP     L0E4A
   0E3A                     683 L0E3A:
   0E3A B9            [ 4]  684         DEC     Y
   0E3B F0            [ 4]  685         LDA     ,Y
   0E3C ED 03         [ 4]  686         AND     #0x03
   0E3E 0B            [ 2]  687         BNE     L0E4A
   0E3F A9            [ 4]  688         INC     Y
   0E40 F0            [ 4]  689         LDA     ,Y
   0E41 ED 03         [ 4]  690         AND     #0x03
   0E43 EC 01         [ 4]  691         CMP     #0x01
   0E45 06            [ 2]  692         BNE     L0E4C
   0E46 F0            [ 4]  693         LDA     ,Y
   0E47 EC 1C         [ 4]  694         CMP     #0x1C
   0E49 66            [ 2]  695         BCS     L0E50
   0E4A                     696 L0E4A:
   0E4A 9E 59         [ 4]  697         JMP     L0E59
   0E4C                     698 L0E4C:
   0E4C F0            [ 4]  699         LDA     ,Y
   0E4D EC 14         [ 4]  700         CMP     #0x14
   0E4F 49            [ 2]  701         BCC     L0E59
   0E50                     702 L0E50:
   0E50 FF 8A         [ 4]  703         DEC     RAM8A
   0E52 FF 8A         [ 4]  704         DEC     RAM8A
   0E54 F8 8A         [ 4]  705         LDA     RAM8A
   0E56 BC            [ 4]  706         STA     X
   0E57 9E 33         [ 4]  707         JMP     L0E33
   0E59                     708 L0E59:
   0E59 B0 85 FF      [ 4]  709         MVI     FCNT,#0xFF
   0E5C B0 86 FF      [ 4]  710         MVI     VCNT,#0xFF
   0E5F B0 80 18      [ 4]  711         MVI     X,#0x18         ; Read from DATA ROM
   0E62 B0 81 93      [ 4]  712         MVI     Y,#0x93
   0E65                     713 L0E65:
   0E65 E0            [ 4]  714         LDA     ,X
   0E66 B5            [ 4]  715         ROLA 
   0E67 B5            [ 4]  716         ROLA 
   0E68 B5            [ 4]  717         ROLA 
   0E69 B5            [ 4]  718         ROLA 
   0E6A B5            [ 4]  719         ROLA 
   0E6B ED 0F         [ 4]  720         AND     #0x0F
   0E6D F9 85         [ 4]  721         STA     FCNT            ; Store upper nybble here
   0E6F E0            [ 4]  722         LDA     ,X
   0E70 ED 0F         [ 4]  723         AND     #0x0F
   0E72 F9 87         [ 4]  724         STA     SCNT            ; Store lower nybble here
   0E74 EC 0F         [ 4]  725         CMP     #0x0F
   0E76 05            [ 2]  726         BNE     L0E7C
   0E77 B0 86 08      [ 4]  727         MVI     VCNT,#0x08
   0E7A 9F 17         [ 4]  728         JMP     L0F17
   0E7C                     729 L0E7C:
   0E7C FC 8A         [ 4]  730         CMP     RAM8A
   0E7E 61            [ 2]  731         BCS     L0E80
   0E7F 4A            [ 2]  732         BCC     L0E8A
   0E80                     733 L0E80:
   0E80 AC            [ 4]  734         LDA     X
   0E81 FA 87         [ 4]  735         ADD     SCNT
   0E83 BC            [ 4]  736         STA     X
   0E84 A8            [ 4]  737         INC     X
   0E85 B0 81 93      [ 4]  738         MVI     Y,#0x93
   0E88 9E 65         [ 4]  739         JMP     L0E65
   0E8A                     740 L0E8A:
   0E8A A8            [ 4]  741         INC     X
   0E8B E0            [ 4]  742         LDA     ,X
   0E8C ED 03         [ 4]  743         AND     #0x03
   0E8E F9 8C         [ 4]  744         STA     RAM8C
   0E90 F0            [ 4]  745         LDA     ,Y
   0E91 ED 03         [ 4]  746         AND     #0x03
   0E93 FC 8C         [ 4]  747         CMP     RAM8C
   0E95 02            [ 2]  748         BNE     L0E98
   0E96 9E A7         [ 4]  749         JMP     L0EA7
   0E98                     750 L0E98:
   0E98 E0            [ 4]  751         LDA     ,X
   0E99 C7 FF 02      [ 5]  752         BRCLR   #7,A,L0E9E
   0E9C 9E B3         [ 4]  753         JMP     L0EB3
   0E9E                     754 L0E9E:
   0E9E AC            [ 4]  755         LDA     X
   0E9F FA 87         [ 4]  756         ADD     SCNT
   0EA1 BC            [ 4]  757         STA     X
   0EA2 B0 81 93      [ 4]  758         MVI     Y,#0x93
   0EA5 9E 65         [ 4]  759         JMP     L0E65
   0EA7                     760 L0EA7:
   0EA7 E0            [ 4]  761         LDA     ,X
   0EA8 C5 FF 02      [ 5]  762         BRCLR   #5,A,L0EAD
   0EAB 9E FD         [ 4]  763         JMP     L0EFD
   0EAD                     764 L0EAD:
   0EAD C6 FF 02      [ 5]  765         BRCLR   #6,A,L0EB2
   0EB0 9E E1         [ 4]  766         JMP     L0EE1
   0EB2                     767 L0EB2:
   0EB2 A9            [ 4]  768         INC     Y
   0EB3                     769 L0EB3:        
   0EB3 FF 87         [ 4]  770         DEC     SCNT
   0EB5 22            [ 2]  771         BEQ     L0EB8
   0EB6 9E 8A         [ 4]  772         JMP     L0E8A
   0EB8                     773 L0EB8:
   0EB8 AD            [ 4]  774         LDA     Y
   0EB9 EB 93         [ 4]  775         SUB     #0x93
   0EBB FC 8A         [ 4]  776         CMP     RAM8A
   0EBD 26            [ 2]  777         BEQ     L0EC4
   0EBE A8            [ 4]  778         INC     X
   0EBF B0 81 93      [ 4]  779         MVI     Y,#0x93
   0EC2 9E 65         [ 4]  780         JMP     L0E65
   0EC4                     781 L0EC4:
   0EC4 F8 85         [ 4]  782         LDA     FCNT
   0EC6 F9 86         [ 4]  783         STA     VCNT
   0EC8 EC 0E         [ 4]  784         CMP     #0x0E
   0ECA 22            [ 2]  785         BEQ     L0ECD
   0ECB 9F 17         [ 4]  786         JMP     L0F17
   0ECD                     787 L0ECD:
   0ECD B0 81 93      [ 4]  788         MVI     Y,#0x93
   0ED0 A9            [ 4]  789         INC     Y
   0ED1 F0            [ 4]  790         LDA     ,Y
   0ED2 ED FC         [ 4]  791         AND     #0xFC
   0ED4 EC 77         [ 4]  792         CMP     #0x77
   0ED6 45            [ 2]  793         BCC     L0EDC
   0ED7 B0 86 03      [ 4]  794         MVI     VCNT,#0x03
   0EDA 9F 17         [ 4]  795         JMP     L0F17
   0EDC                     796 L0EDC:
   0EDC B0 86 01      [ 4]  797         MVI     VCNT,#0x01
   0EDF 9F 17         [ 4]  798         JMP     L0F17
   0EE1                     799 L0EE1:
   0EE1 C0 8C 0A      [ 5]  800         BRCLR   #0,RAM8C,L0EEE
   0EE4 F0            [ 4]  801         LDA     ,Y
   0EE5 ED FC         [ 4]  802         AND     #0xFC
   0EE7 EC 5B         [ 4]  803         CMP     #0x5B
   0EE9 42            [ 2]  804         BCC     L0EEC
   0EEA 9E 9E         [ 4]  805         JMP     L0E9E
   0EEC                     806 L0EEC:
   0EEC 9E B2         [ 4]  807         JMP     L0EB2
   0EEE                     808 L0EEE:
   0EEE EC 02         [ 4]  809         CMP     #0x02
   0EF0 22            [ 2]  810         BEQ     L0EF3
   0EF1 9E B2         [ 4]  811         JMP     L0EB2
   0EF3                     812 L0EF3:
   0EF3 F0            [ 4]  813         LDA     ,Y
   0EF4 ED FC         [ 4]  814         AND     #0xFC
   0EF6 EC 18         [ 4]  815         CMP     #0x18
   0EF8 42            [ 2]  816         BCC     L0EFB
   0EF9 9E 9E         [ 4]  817         JMP     L0E9E
   0EFB                     818 L0EFB:
   0EFB 9E B2         [ 4]  819         JMP     L0EB2
   0EFD                     820 L0EFD:
   0EFD C0 8C 0A      [ 5]  821         BRCLR   #0,RAM8C,L0F0A
   0F00 F0            [ 4]  822         LDA     ,Y
   0F01 ED FC         [ 4]  823         AND     #0xFC
   0F03 EC 5B         [ 4]  824         CMP     #0x5B
   0F05 42            [ 2]  825         BCC     L0F08
   0F06                     826 L0F06:
   0F06 9E B2         [ 4]  827         JMP     L0EB2
   0F08                     828 L0F08:
   0F08 9E 9E         [ 4]  829         JMP     L0E9E
   0F0A                     830 L0F0A:
   0F0A EC 02         [ 4]  831         CMP     #0x02
   0F0C 19            [ 2]  832         BNE     L0F06
   0F0D F0            [ 4]  833         LDA     ,Y
   0F0E ED FC         [ 4]  834         AND     #0xFC
   0F10 EC 18         [ 4]  835         CMP     #0x18
   0F12 42            [ 2]  836         BCC     L0F15
   0F13 9E B2         [ 4]  837         JMP     L0EB2
   0F15                     838 L0F15:
   0F15 9E 9E         [ 4]  839         JMP     L0E9E
   0F17                     840 L0F17:
   0F17 C1 82 02      [ 5]  841         BRCLR   #1,V,L0F1C
   0F1A 9F 4F         [ 4]  842         JMP     L0F4F
   0F1C                     843 L0F1C:
   0F1C F8 86         [ 4]  844         LDA     VCNT
   0F1E C3 FF 02      [ 5]  845         BRCLR   #3,A,L0F23
   0F21 9C 1B         [ 4]  846         JMP     L0C1B
   0F23                     847 L0F23:
   0F23 F8 86         [ 4]  848         LDA     VCNT
   0F25 EA 55         [ 4]  849         ADD     #0x55
   0F27 BD            [ 4]  850         STA     Y
   0F28 F0            [ 4]  851         LDA     ,Y
   0F29 F9 88         [ 4]  852         STA     RAM88
   0F2B 8F 7B         [ 4]  853         JSR     L0F7B
   0F2D B0 FE FF      [ 4]  854         MVI     TCOUNT,#0xFF
   0F30 B0 09 3F      [ 4]  855         MVI     TSTATUS,#0x3F
   0F33                     856 L0F33:
   0F33 D8 01         [ 4]  857         BSET    #0,PORTB        ; XXXX XXX1
   0F35 E8 04         [ 4]  858         LDA     #0x04
   0F37 FF FF         [ 4]  859         DEC     A
   0F39 AC            [ 4]  860         LDA     X
   0F3A D0 01         [ 4]  861         BCLR    #0,PORTB        ; XXXX XXX0
   0F3C E8 04         [ 4]  862         LDA     #0x04
   0F3E FF FF         [ 4]  863         DEC     A
   0F40 AC            [ 4]  864         LDA     X
   0F41 C7 09 EF      [ 5]  865         BRCLR   #7,TSTATUS,L0F33
   0F44 B0 FE 80      [ 4]  866         MVI     TCOUNT,#0x80
   0F47 B0 09 3F      [ 4]  867         MVI     TSTATUS,#0x3F
   0F4A                     868 L0F4A:
   0F4A C7 09 FD      [ 5]  869         BRCLR   #7,TSTATUS,L0F4A
   0F4D 9C 1B         [ 4]  870         JMP     L0C1B
   0F4F                     871 L0F4F:
   0F4F B0 80 FE      [ 4]  872         MVI     X,#0xFE
   0F52 F8 86         [ 4]  873         LDA     VCNT
   0F54 EC 02         [ 4]  874         CMP     #0x02
   0F56 68            [ 2]  875         BCS     L0F5F
   0F57 24            [ 2]  876         BEQ     L0F5C
   0F58 B0 80 FB      [ 4]  877         MVI     X,#0xFB
   0F5B 03            [ 2]  878         BNE     L0F5F
   0F5C                     879 L0F5C:
   0F5C B0 80 FD      [ 4]  880         MVI     X,#0xFD
   0F5F                     881 L0F5F:
   0F5F C7 00 09      [ 5]  882         BRCLR   #7,PORTA,L0F6B  ; check mode bit
                            883 
                            884 ; mode bit is 1
   0F62 AC            [ 4]  885         LDA     X
   0F63 F9 01         [ 4]  886         STA     PORTB
   0F65 D7 01         [ 4]  887         BCLR    #7,PORTB        ; 0XXX XXXX
   0F67 DF 01         [ 4]  888         BSET    #7,PORTB        ; 1XXX XXXX
   0F69 9C 1B         [ 4]  889         JMP     L0C1B
                            890 
                            891 ; mode bit is 0
   0F6B                     892 L0F6B:
   0F6B E8 01         [ 4]  893         LDA     #0x01
   0F6D                     894 L0F6D:
   0F6D FF 86         [ 4]  895         DEC     VCNT
   0F6F CF 86 04      [ 5]  896         BRSET   #7,VCNT,L0F76
   0F72 FA FF         [ 4]  897         ADD     A
   0F74 9F 6D         [ 4]  898         JMP     L0F6D
   0F76                     899 L0F76:
   0F76 B4            [ 4]  900         COMA 
   0F77 F9 01         [ 4]  901         STA     PORTB
   0F79 9C 1B         [ 4]  902         JMP     L0C1B
                            903 
                            904 ; Middle part of special mode
                            905 ; Secret code - parameter in RAM88
                            906 
   0F7B                     907 L0F7B:
   0F7B F8 88         [ 4]  908         LDA     RAM88
                            909 
   0F7D D0 82         [ 4]  910         BCLR    #0,V
   0F7F B0 89 06      [ 4]  911         MVI     RAM89,#0x06
   0F82 B0 09 3B      [ 4]  912         MVI     TSTATUS,#0x3B
   0F85 B0 FE 82      [ 4]  913         MVI     TCOUNT,#0x82
   0F88 D7 01         [ 4]  914         BCLR    #7,PORTB        ; 0XXX XXXX
   0F8A                     915 L0F8A:
   0F8A C7 09 FD      [ 5]  916         BRCLR   #7,TSTATUS,L0F8A
   0F8D B0 FE 34      [ 4]  917         MVI     TCOUNT,#0x34
   0F90 DF 01         [ 4]  918         BSET    #7,PORTB        ; 1XXX XXXX
   0F92 D7 09         [ 4]  919         BCLR    #7,TSTATUS
   0F94                     920 L0F94:
   0F94 C7 09 FD      [ 5]  921         BRCLR   #7,TSTATUS,L0F94
   0F97                     922 L0F97:
   0F97 B0 FE 34      [ 4]  923         MVI     TCOUNT,#0x34
   0F9A F9 01         [ 4]  924         STA     PORTB           ; PPPP PPPP
   0F9C D7 09         [ 4]  925         BCLR    #7,TSTATUS
   0F9E FA FF         [ 4]  926         ADD     A
   0FA0 FF 89         [ 4]  927         DEC     RAM89      
   0FA2 22            [ 2]  928         BEQ     L0FA5
   0FA3 9F C2         [ 4]  929         JMP     L0FC2
   0FA5                     930 L0FA5:
   0FA5 C0 82 10      [ 5]  931         BRCLR   #0,V,L0FB8
   0FA8                     932 L0FA8:
   0FA8 C7 09 FD      [ 5]  933         BRCLR   #7,TSTATUS,L0FA8
   0FAB B0 01 FE      [ 4]  934         MVI     PORTB,#0xFE     ; 1111 1110
   0FAE B0 FE 40      [ 4]  935         MVI     TCOUNT,#0x40
   0FB1 B0 09 3F      [ 4]  936         MVI     TSTATUS,#0x3F   ; 
   0FB4                     937 L0FB4:
   0FB4 C7 09 FD      [ 5]  938         BRCLR   #7,TSTATUS,L0FB4
   0FB7 B3            [ 2]  939         RTS 
   0FB8                     940 L0FB8:
   0FB8 F8 88         [ 4]  941         LDA     RAM88
   0FBA B4            [ 4]  942         COMA 
   0FBB ED FC         [ 4]  943         AND     #0xFC
   0FBD B0 89 06      [ 4]  944         MVI     RAM89,#0x06
   0FC0 D8 82         [ 4]  945         BSET    #0,V
   0FC2                     946 L0FC2:
   0FC2 C7 09 FD      [ 5]  947         BRCLR   #7,TSTATUS,L0FC2
   0FC5 9F 97         [ 4]  948         JMP     L0F97
                            949 
                            950 ; Read and classify Frames?
   0FC7                     951 L0FC7:
   0FC7 B0 80 52      [ 4]  952         MVI     X,#0x52         ; X delay set to 0x52 - ~10ms frame?
   0FCA B0 09 08      [ 4]  953         MVI     TSTATUS,#0x08   ; Timer input mode, count pulses
   0FCD B0 FE 80      [ 4]  954         MVI     TCOUNT,#0x80    ; count set to 128
   0FD0 FB FF         [ 4]  955         SUB     A               ; clear A
   0FD2                     956 L0FD2:
   0FD2 C7 FE 09      [ 5]  957         BRCLR   #7,TCOUNT,L0FDE ; if we got a transition, jump
   0FD5 A9            [ 4]  958         INC     Y
   0FD6 B9            [ 4]  959         DEC     Y
   0FD7 A9            [ 4]  960         INC     Y
   0FD8 B9            [ 4]  961         DEC     Y
   0FD9 FE FF         [ 4]  962         INC     A               ; increment the running counter
   0FDB                     963 L0FDB:
   0FDB B8            [ 4]  964         DEC     X
   0FDC 15            [ 2]  965         BNE     L0FD2           ; Delay loop
   0FDD B3            [ 2]  966         RTS
   0FDE                     967 L0FDE:
   0FDE FC 5D         [ 4]  968         CMP     ROM5D           ; Compare against User Data ROM (0x02)
   0FE0 48            [ 2]  969         BCC     L0FE9           ; If >= 2, jump
   0FE1 FE 87         [ 4]  970         INC     SCNT            ; count is 0 or 1, increment SCNT
   0FE3                     971 L0FE3:
   0FE3 B0 FE 80      [ 4]  972         MVI     TCOUNT,#0x80    ; reset the transition counter
   0FE6 FB FF         [ 4]  973         SUB     A               ; clear A
   0FE8 32            [ 2]  974         BEQ     L0FDB           ; count down, loop around
   0FE9                     975 L0FE9:
   0FE9 FC 5E         [ 4]  976         CMP     ROM5E           ; Compare against User Data ROM (0x07)
   0FEB 45            [ 2]  977         BCC     L0FF1           ; if >= 7, jump
   0FEC FE 86         [ 4]  978         INC     VCNT            ; VCNT
   0FEE 14            [ 2]  979         BNE     L0FE3           ; if VCNT is not zero, loop around
   0FEF 9F DB         [ 4]  980         JMP     L0FDB           ; else count down, loop around
   0FF1                     981 L0FF1:
   0FF1 FC 5F         [ 4]  982         CMP     ROM5F           ; Compare against User Data ROM (0x18)
   0FF3 42            [ 2]  983         BCC     L0FF6           ; if >= 24, jump - too high
   0FF4 FE 85         [ 4]  984         INC     FCNT            ; FCNT
   0FF6                     985 L0FF6:
   0FF6 9F E3         [ 4]  986         JMP     L0FE3           ; 
                            987 
                            988 ; VECTORS
                            989 
   0FF8 9B E3         [ 4]  990         JMP     SELFIRQ         ; SELF-TEST IRQ VECTOR
   0FFA 9A F6         [ 4]  991         JMP     SELFTST         ; SELF-TEST RESTART VECTOR
                            992 
   0FFC 9C 10         [ 4]  993         JMP     START           ; USER IRQ VECTOR
   0FFE 9C 10         [ 4]  994         JMP     START           ; USER RESTART VECTOR
