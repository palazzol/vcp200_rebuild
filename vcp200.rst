                              1 ;
                              2 ; VCP200 circuit
                              3 ;
                              4 ; PB0 - 8 - GO/NO-ON 
                              5 ; PB1 - 9 - TURN RIGHT/YES-OFF
                              6 ; PB2 - 10 - REVERSE/NOT SURE
                              7 ; PB3 - 11 - SLOW
                              8 ; PB4 - 12 - STOP
                              9 ; PB5 - 13 - TAXI or RESET
                             10 ; PB6 - 14 - LEFT TURN
                             11 ; PB7 - 15 - BUCKETS or LIGHTS
                             12 ; TIMER - 7 - DATA IN 
                             13 ; PA7 - 19 - MODE - high = Yes/No/On/Off mode
                             14 ; PA6 - 18 - grounded; do middle part of special mode
                             15 ; PA5 - 17 - Vcc
                             16 ; PA4 - 16 - Vcc
                             17 ; ~IRQ - 2 - Hardwired to + (unused)
                             18 ; 10 Mhz Xtal
                             19 ;
                             20 
                             21 .include "vcp200.def"
                              1 
                              2 ; MC6804P2 Data Space Defines
                              3 
                     0000     4 PORTA   .equ    0x00
                     0001     5 PORTB   .equ    0x01
                     0004     6 DDRA    .equ    0x04
                     0005     7 DDRB    .equ    0x05
                              8 
                     0009     9 TSTATUS .equ    0x09
                             10 
                     005D    11 ROM5D   .equ    0x5D
                     005E    12 ROM5E   .equ    0x5E
                     005F    13 ROM5F   .equ    0x5F
                             14 
                     0080    15 X       .equ    0x80
                     0081    16 Y       .equ    0x81
                     0082    17 V       .equ    0x82
                     0083    18 W       .equ    0x83
                     0084    19 RAM84   .equ    0x84
                             20 
                     0085    21 FCNT    .equ    0x85
                     0086    22 VCNT    .equ    0x86
                     0087    23 SCNT    .equ    0x87
                             24 
                     0088    25 RAM88   .equ    0x88        ; N?
                     0089    26 RAM89   .equ    0x89
                     008A    27 RAM8A   .equ    0x8A
                     008B    28 RAM8B   .equ    0x8B
                     008C    29 RAM8C   .equ    0x8C
                     008D    30 RAM8D   .equ    0x8D
                     008E    31 RAM8E   .equ    0x8E
                     008F    32 RAM8F   .equ    0x8F
                     0090    33 RAM90   .equ    0x90
                     0091    34 RAM91   .equ    0x91
                     0092    35 RAM92   .equ    0x92
                             36 
                     009E    37 RAM9E   .equ    0x9E
                     009F    38 RAM9F   .equ    0x9F
                             39 
                     00FD    40 PRESCALE    .equ    0xFD
                     00FE    41 TCOUNT  .equ    0xFE
                     00FF    42 A       .equ    0xFF
                             22 ; MC6804P2 Data Space Defines
                             23 
                             24         ; VCP200 - Program ROM
                             25 
                             26         .area   CODE1   (ABS)
                             27 
   0C02                      28         .org    0x0C02
                             29 
   0C02                      30 L0C02:
   0C02 4D 43 36 38 30 34    31         .ASCII  'MC6804J2 - ATX'
        4A 32 20 2D 20 41
        54 58
                             32 ;
                             33 ; VCP200 - USER PROGRAM START
                             34 ;
                             35 
   0C10                      36 START:
                             37 
                             38 ; Init pins
   0C10 B0 05 FF      [ 4]   39         MVI     DDRB,#0xFF      ; Port B - all outputs
   0C13 B0 01 FE      [ 4]   40         MVI     PORTB,#0xFE
   0C16 B0 04 00      [ 4]   41         MVI     DDRA,#0x00      ; Port A - all inputs
                             42 
                             43 ; Init RAM
   0C19 D1 82         [ 4]   44         BCLR    #1,V            ; clear test bit??
                             45 ; Main loop
   0C1B                      46 L0C1B:
                             47         ; clear RAM from $83 to $9F
   0C1B B0 81 1D      [ 4]   48         MVI     Y,#0x1D
   0C1E B0 80 83      [ 4]   49         MVI     X,#0x83
   0C21 E8 00         [ 4]   50         LDA     #0x00
   0C23                      51 RAMCLR:
   0C23 E1            [ 4]   52         STA     ,X
   0C24 A8            [ 4]   53         INC     X
   0C25 B9            [ 4]   54         DEC     Y
   0C26 1C            [ 2]   55         BNE     RAMCLR
                             56 
   0C27 B0 81 93      [ 4]   57         MVI     Y,#0x93         ; Y points to 0x93
   0C2A                      58 L0C2A:
   0C2A E8 00         [ 4]   59         LDA     #0x00
   0C2C F9 85         [ 4]   60         STA     FCNT
   0C2E F9 86         [ 4]   61         STA     VCNT
   0C30 F9 87         [ 4]   62         STA     SCNT
   0C32 8F C7         [ 4]   63         JSR     L0FC7           ; Read and classify frames?
   0C34 C1 82 02      [ 5]   64         BRCLR   #1,V,L0C39
                             65 
   0C37 9D 14         [ 4]   66         JMP     L0D14
   0C39                      67 L0C39:
   0C39 B0 01 80      [ 4]   68         MVI     PORTB,#0x80     ; 1000 0000
   0C3C F8 00         [ 4]   69         LDA     PORTA           ; check PORTA upper nibble
   0C3E ED F0         [ 4]   70         AND     #0xF0
   0C40 EC F0         [ 4]   71         CMP     #0xF0
   0C42 02            [ 2]   72         BNE     L0C45           ; always jump because PA6 is grounded?
   0C43 9D 14         [ 4]   73         JMP     L0D14           ; PORTA is 1111 - unknown mode jump?
                             74 
                             75 ; Try to decode Normal mode or Special modes
   0C45                      76 L0C45:
   0C45 D1 82         [ 4]   77         BCLR    #1,V
   0C47 B0 01 FC      [ 4]   78         MVI     PORTB,#0xFC     ; 1111 1100
   0C4A CC 00 05      [ 5]   79         BRSET   #4,PORTA,L0C52  ; should be high
   0C4D B0 88 DC      [ 4]   80         MVI     RAM88,#0xDC
   0C50 9C FD         [ 4]   81         JMP     L0CFD           ; PORTA is XXX0 - secret code 0xdc?
   0C52                      82 L0C52:
   0C52 CD 00 05      [ 5]   83         BRSET   #5,PORTA,L0C5A  ; should be high
   0C55 B0 88 74      [ 4]   84         MVI     RAM88,#0x74
   0C58 9C FD         [ 4]   85         JMP     L0CFD           ; PORTA is XX01 - secret code 0x74?
   0C5A                      86 L0C5A:
   0C5A CE 00 07      [ 5]   87         BRSET   #6,PORTA,L0C64  ; should be low
   0C5D D9 82         [ 4]   88         BSET    #1,V
   0C5F B0 01 FF      [ 4]   89         MVI     PORTB,#0xFF     ; 1111 1111
   0C62 9D 14         [ 4]   90         JMP     L0D14           ; PORTA is X011 - normal mode
   0C64                      91 L0C64:
   0C64 CF 00 05      [ 5]   92         BRSET   #7,PORTA,L0C6C  ;
   0C67 B0 88 78      [ 4]   93         MVI     RAM88,#0x78
   0C6A 9C FD         [ 4]   94         JMP     L0CFD           ; PORTA is 0111 - secret code 0x78?
                             95 
   0C6C                      96 L0C6C:
   0C6C B0 01 FA      [ 4]   97         MVI     PORTB,#0xFA     ; PORTA is 1111 - 1111 1010
   0C6F CC 00 05      [ 5]   98         BRSET   #4,PORTA,L0C77     
   0C72 B0 88 D8      [ 4]   99         MVI     RAM88,#0xD8
   0C75 9C FD         [ 4]  100         JMP     L0CFD           ; secret code 0xd8?
   0C77                     101 L0C77:
   0C77 CD 00 05      [ 5]  102         BRSET   #5,PORTA,L0C7F
   0C7A B0 88 BC      [ 4]  103         MVI     RAM88,#0xBC         
   0C7D 9C FD         [ 4]  104         JMP     L0CFD           ; secret code 0xbc?
   0C7F                     105 L0C7F:
   0C7F CE 00 05      [ 5]  106         BRSET   #6,PORTA,L0C87
   0C82 B0 88 EC      [ 4]  107         MVI     RAM88,#0xEC
   0C85 9C FD         [ 4]  108         JMP     L0CFD           ; secret code 0xec?
                            109 
   0C87                     110 L0C87:
   0C87 B0 01 F6      [ 4]  111         MVI     PORTB,#0xF6     ; 1111 0110
   0C8A CD 00 05      [ 5]  112         BRSET   #5,PORTA,L0C92
   0C8D B0 88 B8      [ 4]  113         MVI     RAM88,#0xB8
   0C90 9C FD         [ 4]  114         JMP     L0CFD           ; secret code 0xb8?
   0C92                     115 L0C92:
   0C92 CE 00 05      [ 5]  116         BRSET   #6,PORTA,L0C9A
   0C95 B0 88 E8      [ 4]  117         MVI     RAM88,#0xE8
   0C98 9C FD         [ 4]  118         JMP     L0CFD           ; secret code 0xe8?
   0C9A                     119 L0C9A:
   0C9A CF 00 05      [ 5]  120         BRSET   #7,PORTA,L0CA2
   0C9D B0 88 FC      [ 4]  121         MVI     RAM88,#0xFC
   0CA0 9C FD         [ 4]  122         JMP     L0CFD           ; secret code 0xfc?
                            123 
   0CA2                     124 L0CA2:
   0CA2 B0 01 EE      [ 4]  125         MVI     PORTB,#0xEE     ; 1110 1110
   0CA5 CD 00 05      [ 5]  126         BRSET   #5,PORTA,L0CAD
   0CA8 B0 88 B4      [ 4]  127         MVI     RAM88,#0xB4
   0CAB 9C FD         [ 4]  128         JMP     L0CFD           ; secret code 0xb4?
   0CAD                     129 L0CAD:
   0CAD CE 00 05      [ 5]  130         BRSET   #6,PORTA,L0CB5
   0CB0 B0 88 E4      [ 4]  131         MVI     RAM88,#0xE4
   0CB3 9C FD         [ 4]  132         JMP     L0CFD           ; secret code 0xe4?
   0CB5                     133 L0CB5:
   0CB5 CF 00 05      [ 5]  134         BRSET   #7,PORTA,L0CBD
   0CB8 B0 88 F4      [ 4]  135         MVI     RAM88,#0xF4
   0CBB 9C FD         [ 4]  136         JMP     L0CFD           ; secret code 0xf4?
                            137 
   0CBD                     138 L0CBD:
   0CBD B0 01 DE      [ 4]  139         MVI     PORTB,#0xDE     ; 1101 1110
   0CC0 CC 00 05      [ 5]  140         BRSET   #4,PORTA,L0CC8
   0CC3 B0 88 F8      [ 4]  141         MVI     RAM88,#0xF8
   0CC6 9C FD         [ 4]  142         JMP     L0CFD           ; secret code 0xf8?
   0CC8                     143 L0CC8:
   0CC8 CD 00 05      [ 5]  144         BRSET   #5,PORTA,L0CD0
   0CCB B0 88 70      [ 4]  145         MVI     RAM88,#0x70
   0CCE 9C FD         [ 4]  146         JMP     L0CFD           ; secret code 0x70?
   0CD0                     147 L0CD0:
   0CD0 CE 00 05      [ 5]  148         BRSET   #6,PORTA,L0CD8
   0CD3 B0 88 E0      [ 4]  149         MVI     RAM88,#0xE0
   0CD6 9C FD         [ 4]  150         JMP     L0CFD           ; secret code 0xe0?
   0CD8                     151 L0CD8:
   0CD8 CF 00 05      [ 5]  152         BRSET   #7,PORTA,L0CE0
   0CDB B0 88 F0      [ 4]  153         MVI     RAM88,#0xF0
   0CDE 9C FD         [ 4]  154         JMP     L0CFD           ; secret code 0xf0?
                            155 
   0CE0                     156 L0CE0:
   0CE0 B0 01 BE      [ 4]  157         MVI     PORTB,#0xBE     ; 1011 1110
   0CE3 CC 00 05      [ 5]  158         BRSET   #4,PORTA,L0CEB
   0CE6 B0 88 D0      [ 4]  159         MVI     RAM88,#0xD0
   0CE9 9C FD         [ 4]  160         JMP     L0CFD           ; secret code 0xd0?
   0CEB                     161 L0CEB:
   0CEB CE 00 05      [ 5]  162         BRSET   #6,PORTA,L0CF3
   0CEE B0 88 7C      [ 4]  163         MVI     RAM88,#0x7C
   0CF1 9C FD         [ 4]  164         JMP     L0CFD           ; secret code 0x7c?
   0CF3                     165 L0CF3:
   0CF3 CF 00 05      [ 5]  166         BRSET   #7,PORTA,L0CFB
   0CF6 B0 88 D4      [ 4]  167         MVI     RAM88,#0xD4
   0CF9 9C FD         [ 4]  168         JMP     L0CFD           ; secret code 0xd4?
   0CFB                     169 L0CFB:
   0CFB 9D 14         [ 4]  170         JMP     L0D14
                            171 
                            172 ; do middle part of special mode
   0CFD                     173 L0CFD:
   0CFD 8F 7B         [ 4]  174         JSR     L0F7B           ; secret code trampoline
                            175 
                            176 ; do last part of special mode and go back to memory clear
                            177 
   0CFF B0 01 80      [ 4]  178         MVI     PORTB,#0x80     ; 1000 0000
   0D02                     179 L0D02:
   0D02 F8 00         [ 4]  180         LDA     PORTA           ; wait loop until PORTA = 1111
   0D04 ED F0         [ 4]  181         AND     #0xF0
   0D06 EC F0         [ 4]  182         CMP     #0xF0
   0D08 19            [ 2]  183         BNE     L0D02
   0D09 B0 FE 40      [ 4]  184         MVI     TCOUNT,#0x40
   0D0C B0 09 3F      [ 4]  185         MVI     TSTATUS,#0x3F
   0D0F                     186 L0D0F:
   0D0F C7 09 FD      [ 5]  187         BRCLR   #7,TSTATUS,L0D0F
   0D12 9C 1B         [ 4]  188         JMP     L0C1B
                            189 
                            190 ; Normal mode
                            191 
   0D14                     192 L0D14:
   0D14 F8 8B         [ 4]  193         LDA     RAM8B           ; Shift 0x88:8B -> 89:8C
   0D16 F9 8C         [ 4]  194         STA     RAM8C
   0D18 F8 8A         [ 4]  195         LDA     RAM8A
   0D1A F9 8B         [ 4]  196         STA     RAM8B
   0D1C F8 89         [ 4]  197         LDA     RAM89
   0D1E F9 8A         [ 4]  198         STA     RAM8A
   0D20 F8 88         [ 4]  199         LDA     RAM88
   0D22 F9 89         [ 4]  200         STA     RAM89
                            201 
   0D24 F8 85         [ 4]  202         LDA     FCNT
   0D26 FA 86         [ 4]  203         ADD     VCNT
   0D28 FA 87         [ 4]  204         ADD     SCNT
   0D2A EC 02         [ 4]  205         CMP     #0x02
   0D2C 45            [ 2]  206         BCC     L0D32
   0D2D B0 88 00      [ 4]  207         MVI     RAM88,#0x00
   0D30 9D 4C         [ 4]  208         JMP     L0D4C
   0D32                     209 L0D32:
   0D32 F8 87         [ 4]  210         LDA     SCNT
   0D34 EC 10         [ 4]  211         CMP     #0x10
   0D36 42            [ 2]  212         BCC     L0D39
   0D37 9D 49         [ 4]  213         JMP     L0D49
   0D39                     214 L0D39:
   0D39 FC 86         [ 4]  215         CMP     VCNT
   0D3B 65            [ 2]  216         BCS     L0D41
   0D3C B0 88 02      [ 4]  217         MVI     RAM88,#0x02
   0D3F 9D 4C         [ 4]  218         JMP     L0D4C
   0D41                     219 L0D41:
   0D41 F8 85         [ 4]  220         LDA     FCNT
   0D43 05            [ 2]  221         BNE     L0D49
   0D44 B0 88 02      [ 4]  222         MVI     RAM88,#0x02
   0D47 9D 4C         [ 4]  223         JMP     L0D4C
   0D49                     224 L0D49:
   0D49 B0 88 01      [ 4]  225         MVI     RAM88,#0x01
   0D4C                     226 L0D4C:
   0D4C B0 85 00      [ 4]  227         MVI     FCNT,#0x00
   0D4F B0 86 00      [ 4]  228         MVI     VCNT,#0x00
   0D52 B0 87 00      [ 4]  229         MVI     SCNT,#0x00
   0D55 E8 85         [ 4]  230         LDA     #0x85
   0D57 FA 88         [ 4]  231         ADD     RAM88
   0D59 BC            [ 4]  232         STA     X
   0D5A E6            [ 4]  233         INC     ,X
   0D5B E8 85         [ 4]  234         LDA     #0x85
   0D5D FA 89         [ 4]  235         ADD     RAM89
   0D5F BC            [ 4]  236         STA     X
   0D60 E6            [ 4]  237         INC     ,X
   0D61 E8 85         [ 4]  238         LDA     #0x85
   0D63 FA 8A         [ 4]  239         ADD     RAM8A
   0D65 BC            [ 4]  240         STA     X
   0D66 E6            [ 4]  241         INC     ,X
   0D67 E8 85         [ 4]  242         LDA     #0x85
   0D69 FA 8B         [ 4]  243         ADD     RAM8B
   0D6B BC            [ 4]  244         STA     X
   0D6C E6            [ 4]  245         INC     ,X
   0D6D E8 85         [ 4]  246         LDA     #0x85
   0D6F FA 8C         [ 4]  247         ADD     RAM8C
   0D71 BC            [ 4]  248         STA     X
   0D72 E6            [ 4]  249         INC     ,X
   0D73 F8 85         [ 4]  250         LDA     FCNT
   0D75 EC 02         [ 4]  251         CMP     #0x02
   0D77 65            [ 2]  252         BCS     L0D7D
   0D78 B0 92 00      [ 4]  253         MVI     RAM92,#0x00
   0D7B 9D 94         [ 4]  254         JMP     L0D94
   0D7D                     255 L0D7D:
   0D7D F8 86         [ 4]  256         LDA     VCNT
   0D7F EC 04         [ 4]  257         CMP     #0x04
   0D81 65            [ 2]  258         BCS     L0D87
   0D82 B0 92 01      [ 4]  259         MVI     RAM92,#0x01
   0D85 9D 94         [ 4]  260         JMP     L0D94
   0D87                     261 L0D87:
   0D87 F8 87         [ 4]  262         LDA     SCNT
   0D89 EC 03         [ 4]  263         CMP     #0x03
   0D8B 65            [ 2]  264         BCS     L0D91
   0D8C B0 92 02      [ 4]  265         MVI     RAM92,#0x02
   0D8F 9D 94         [ 4]  266         JMP     L0D94
   0D91                     267 L0D91:
   0D91 B0 92 80      [ 4]  268         MVI     RAM92,#0x80
   0D94                     269 L0D94:
   0D94 FE 8E         [ 4]  270         INC     RAM8E
   0D96                     271 L0D96:
   0D96 C7 92 02      [ 5]  272         BRCLR   #7,RAM92,L0D9B
   0D99 9C 2A         [ 4]  273         JMP     L0C2A
   0D9B                     274 L0D9B:
   0D9B F8 92         [ 4]  275         LDA     RAM92
   0D9D FC 8F         [ 4]  276         CMP     RAM8F
   0D9F 02            [ 2]  277         BNE     L0DA2
   0DA0 9E 08         [ 4]  278         JMP     L0E08
   0DA2                     279 L0DA2:
   0DA2 F8 8D         [ 4]  280         LDA     RAM8D
   0DA4 0C            [ 2]  281         BNE     L0DB1
   0DA5 F8 92         [ 4]  282         LDA     RAM92
   0DA7 F9 8F         [ 4]  283         STA     RAM8F
   0DA9 B0 8D 01      [ 4]  284         MVI     RAM8D,#0x01
   0DAC B0 90 01      [ 4]  285         MVI     RAM90,#0x01
   0DAF                     286 L0DAF:
   0DAF 9C 2A         [ 4]  287         JMP     L0C2A
   0DB1                     288 L0DB1:
   0DB1 F8 8F         [ 4]  289         LDA     RAM8F
   0DB3 2A            [ 2]  290         BEQ     L0DBE
   0DB4 EC 01         [ 4]  291         CMP     #0x01
   0DB6 02            [ 2]  292         BNE     L0DB9
   0DB7 9D F8         [ 4]  293         JMP     L0DF8
   0DB9                     294 L0DB9:
   0DB9 EC 02         [ 4]  295         CMP     #0x02
   0DBB 13            [ 2]  296         BNE     L0DAF
   0DBC 9E 01         [ 4]  297         JMP     L0E01
   0DBE                     298 L0DBE:
   0DBE F8 90         [ 4]  299         LDA     RAM90
   0DC0 EC 02         [ 4]  300         CMP     #0x02
   0DC2 62            [ 2]  301         BCS     L0DC5
   0DC3 9D D9         [ 4]  302         JMP     L0DD9
   0DC5                     303 L0DC5:
   0DC5 AD            [ 4]  304         LDA     Y
   0DC6 EC 93         [ 4]  305         CMP     #0x93
   0DC8 02            [ 2]  306         BNE     L0DCB
   0DC9 9C 1B         [ 4]  307         JMP     L0C1B
   0DCB                     308 L0DCB:
   0DCB B9            [ 4]  309         DEC     Y
   0DCC F0            [ 4]  310         LDA     ,Y
   0DCD ED 03         [ 4]  311         AND     #0x03
   0DCF F9 8F         [ 4]  312         STA     RAM8F
   0DD1 F8 91         [ 4]  313         LDA     RAM91
   0DD3 F9 90         [ 4]  314         STA     RAM90
   0DD5 FF 8D         [ 4]  315         DEC     RAM8D
   0DD7 9D 96         [ 4]  316         JMP     L0D96
   0DD9                     317 L0DD9:
   0DD9 F8 90         [ 4]  318         LDA     RAM90
   0DDB FA FF         [ 4]  319         ADD     A
   0DDD FA FF         [ 4]  320         ADD     A
   0DDF FA 8F         [ 4]  321         ADD     RAM8F
   0DE1 F1            [ 4]  322         STA     ,Y
   0DE2 A9            [ 4]  323         INC     Y
   0DE3 AD            [ 4]  324         LDA     Y
   0DE4 EC 9F         [ 4]  325         CMP     #0x9F
   0DE6 62            [ 2]  326         BCS     L0DE9
   0DE7 9C 1B         [ 4]  327         JMP     L0C1B
   0DE9                     328 L0DE9:
   0DE9 FE 8D         [ 4]  329         INC     RAM8D
   0DEB F8 92         [ 4]  330         LDA     RAM92
   0DED F9 8F         [ 4]  331         STA     RAM8F
   0DEF F8 90         [ 4]  332         LDA     RAM90
   0DF1 F9 91         [ 4]  333         STA     RAM91
   0DF3 B0 90 01      [ 4]  334         MVI     RAM90,#0x01
   0DF6 9C 2A         [ 4]  335         JMP     L0C2A
   0DF8                     336 L0DF8:
   0DF8 F8 90         [ 4]  337         LDA     RAM90
   0DFA EC 04         [ 4]  338         CMP     #0x04
   0DFC 42            [ 2]  339         BCC     L0DFF
   0DFD                     340 L0DFD:
   0DFD 9D C5         [ 4]  341         JMP     L0DC5
   0DFF                     342 L0DFF:
   0DFF 9D D9         [ 4]  343         JMP     L0DD9
   0E01                     344 L0E01:
   0E01 F8 90         [ 4]  345         LDA     RAM90
   0E03 EC 04         [ 4]  346         CMP     #0x04
   0E05 77            [ 2]  347         BCS     L0DFD
   0E06 9D D9         [ 4]  348         JMP     L0DD9
   0E08                     349 L0E08:
   0E08 F8 92         [ 4]  350         LDA     RAM92
   0E0A 2E            [ 2]  351         BEQ     L0E19
   0E0B FE 90         [ 4]  352         INC     RAM90
   0E0D F8 90         [ 4]  353         LDA     RAM90
   0E0F EC 3F         [ 4]  354         CMP     #0x3F
   0E11 63            [ 2]  355         BCS     L0E15
   0E12 B0 90 3F      [ 4]  356         MVI     RAM90,#0x3F
   0E15                     357 L0E15:
   0E15 9C 2A         [ 4]  358         JMP     L0C2A
   0E17                     359 L0E17:
   0E17 9C 1B         [ 4]  360         JMP     L0C1B
   0E19                     361 L0E19:
   0E19 FE 90         [ 4]  362         INC     RAM90
   0E1B F8 90         [ 4]  363         LDA     RAM90
   0E1D EC 18         [ 4]  364         CMP     #0x18
   0E1F 75            [ 2]  365         BCS     L0E15
   0E20 AD            [ 4]  366         LDA     Y
   0E21 EC 94         [ 4]  367         CMP     #0x94
   0E23 42            [ 2]  368         BCC     L0E26
   0E24 9E 17         [ 4]  369         JMP     L0E17
   0E26                     370 L0E26:
   0E26 EB 93         [ 4]  371         SUB     #0x93
   0E28 F9 8D         [ 4]  372         STA     RAM8D
   0E2A F9 8A         [ 4]  373         STA     RAM8A
   0E2C F8 8E         [ 4]  374         LDA     RAM8E
   0E2E EC 20         [ 4]  375         CMP     #0x20
   0E30 42            [ 2]  376         BCC     L0E33
   0E31 9E 17         [ 4]  377         JMP     L0E17
   0E33                     378 L0E33:
   0E33 B9            [ 4]  379         DEC     Y
   0E34 AD            [ 4]  380         LDA     Y
   0E35 EC 95         [ 4]  381         CMP     #0x95
   0E37 42            [ 2]  382         BCC     L0E3A
   0E38 9E 4A         [ 4]  383         JMP     L0E4A
   0E3A                     384 L0E3A:
   0E3A B9            [ 4]  385         DEC     Y
   0E3B F0            [ 4]  386         LDA     ,Y
   0E3C ED 03         [ 4]  387         AND     #0x03
   0E3E 0B            [ 2]  388         BNE     L0E4A
   0E3F A9            [ 4]  389         INC     Y
   0E40 F0            [ 4]  390         LDA     ,Y
   0E41 ED 03         [ 4]  391         AND     #0x03
   0E43 EC 01         [ 4]  392         CMP     #0x01
   0E45 06            [ 2]  393         BNE     L0E4C
   0E46 F0            [ 4]  394         LDA     ,Y
   0E47 EC 1C         [ 4]  395         CMP     #0x1C
   0E49 66            [ 2]  396         BCS     L0E50
   0E4A                     397 L0E4A:
   0E4A 9E 59         [ 4]  398         JMP     L0E59
   0E4C                     399 L0E4C:
   0E4C F0            [ 4]  400         LDA     ,Y
   0E4D EC 14         [ 4]  401         CMP     #0x14
   0E4F 49            [ 2]  402         BCC     L0E59
   0E50                     403 L0E50:
   0E50 FF 8A         [ 4]  404         DEC     RAM8A
   0E52 FF 8A         [ 4]  405         DEC     RAM8A
   0E54 F8 8A         [ 4]  406         LDA     RAM8A
   0E56 BC            [ 4]  407         STA     X
   0E57 9E 33         [ 4]  408         JMP     L0E33
   0E59                     409 L0E59:
   0E59 B0 85 FF      [ 4]  410         MVI     FCNT,#0xFF
   0E5C B0 86 FF      [ 4]  411         MVI     VCNT,#0xFF
   0E5F B0 80 18      [ 4]  412         MVI     X,#0x18         ; Read from DATA ROM
   0E62 B0 81 93      [ 4]  413         MVI     Y,#0x93
   0E65                     414 L0E65:
   0E65 E0            [ 4]  415         LDA     ,X
   0E66 B5            [ 4]  416         ROLA 
   0E67 B5            [ 4]  417         ROLA 
   0E68 B5            [ 4]  418         ROLA 
   0E69 B5            [ 4]  419         ROLA 
   0E6A B5            [ 4]  420         ROLA 
   0E6B ED 0F         [ 4]  421         AND     #0x0F
   0E6D F9 85         [ 4]  422         STA     FCNT            ; Store upper nybble here
   0E6F E0            [ 4]  423         LDA     ,X
   0E70 ED 0F         [ 4]  424         AND     #0x0F
   0E72 F9 87         [ 4]  425         STA     SCNT            ; Store lower nybble here
   0E74 EC 0F         [ 4]  426         CMP     #0x0F
   0E76 05            [ 2]  427         BNE     L0E7C
   0E77 B0 86 08      [ 4]  428         MVI     VCNT,#0x08
   0E7A 9F 17         [ 4]  429         JMP     L0F17
   0E7C                     430 L0E7C:
   0E7C FC 8A         [ 4]  431         CMP     RAM8A
   0E7E 61            [ 2]  432         BCS     L0E80
   0E7F 4A            [ 2]  433         BCC     L0E8A
   0E80                     434 L0E80:
   0E80 AC            [ 4]  435         LDA     X
   0E81 FA 87         [ 4]  436         ADD     SCNT
   0E83 BC            [ 4]  437         STA     X
   0E84 A8            [ 4]  438         INC     X
   0E85 B0 81 93      [ 4]  439         MVI     Y,#0x93
   0E88 9E 65         [ 4]  440         JMP     L0E65
   0E8A                     441 L0E8A:
   0E8A A8            [ 4]  442         INC     X
   0E8B E0            [ 4]  443         LDA     ,X
   0E8C ED 03         [ 4]  444         AND     #0x03
   0E8E F9 8C         [ 4]  445         STA     RAM8C
   0E90 F0            [ 4]  446         LDA     ,Y
   0E91 ED 03         [ 4]  447         AND     #0x03
   0E93 FC 8C         [ 4]  448         CMP     RAM8C
   0E95 02            [ 2]  449         BNE     L0E98
   0E96 9E A7         [ 4]  450         JMP     L0EA7
   0E98                     451 L0E98:
   0E98 E0            [ 4]  452         LDA     ,X
   0E99 C7 FF 02      [ 5]  453         BRCLR   #7,A,L0E9E
   0E9C 9E B3         [ 4]  454         JMP     L0EB3
   0E9E                     455 L0E9E:
   0E9E AC            [ 4]  456         LDA     X
   0E9F FA 87         [ 4]  457         ADD     SCNT
   0EA1 BC            [ 4]  458         STA     X
   0EA2 B0 81 93      [ 4]  459         MVI     Y,#0x93
   0EA5 9E 65         [ 4]  460         JMP     L0E65
   0EA7                     461 L0EA7:
   0EA7 E0            [ 4]  462         LDA     ,X
   0EA8 C5 FF 02      [ 5]  463         BRCLR   #5,A,L0EAD
   0EAB 9E FD         [ 4]  464         JMP     L0EFD
   0EAD                     465 L0EAD:
   0EAD C6 FF 02      [ 5]  466         BRCLR   #6,A,L0EB2
   0EB0 9E E1         [ 4]  467         JMP     L0EE1
   0EB2                     468 L0EB2:
   0EB2 A9            [ 4]  469         INC     Y
   0EB3                     470 L0EB3:        
   0EB3 FF 87         [ 4]  471         DEC     SCNT
   0EB5 22            [ 2]  472         BEQ     L0EB8
   0EB6 9E 8A         [ 4]  473         JMP     L0E8A
   0EB8                     474 L0EB8:
   0EB8 AD            [ 4]  475         LDA     Y
   0EB9 EB 93         [ 4]  476         SUB     #0x93
   0EBB FC 8A         [ 4]  477         CMP     RAM8A
   0EBD 26            [ 2]  478         BEQ     L0EC4
   0EBE A8            [ 4]  479         INC     X
   0EBF B0 81 93      [ 4]  480         MVI     Y,#0x93
   0EC2 9E 65         [ 4]  481         JMP     L0E65
   0EC4                     482 L0EC4:
   0EC4 F8 85         [ 4]  483         LDA     FCNT
   0EC6 F9 86         [ 4]  484         STA     VCNT
   0EC8 EC 0E         [ 4]  485         CMP     #0x0E
   0ECA 22            [ 2]  486         BEQ     L0ECD
   0ECB 9F 17         [ 4]  487         JMP     L0F17
   0ECD                     488 L0ECD:
   0ECD B0 81 93      [ 4]  489         MVI     Y,#0x93
   0ED0 A9            [ 4]  490         INC     Y
   0ED1 F0            [ 4]  491         LDA     ,Y
   0ED2 ED FC         [ 4]  492         AND     #0xFC
   0ED4 EC 77         [ 4]  493         CMP     #0x77
   0ED6 45            [ 2]  494         BCC     L0EDC
   0ED7 B0 86 03      [ 4]  495         MVI     VCNT,#0x03
   0EDA 9F 17         [ 4]  496         JMP     L0F17
   0EDC                     497 L0EDC:
   0EDC B0 86 01      [ 4]  498         MVI     VCNT,#0x01
   0EDF 9F 17         [ 4]  499         JMP     L0F17
   0EE1                     500 L0EE1:
   0EE1 C0 8C 0A      [ 5]  501         BRCLR   #0,RAM8C,L0EEE
   0EE4 F0            [ 4]  502         LDA     ,Y
   0EE5 ED FC         [ 4]  503         AND     #0xFC
   0EE7 EC 5B         [ 4]  504         CMP     #0x5B
   0EE9 42            [ 2]  505         BCC     L0EEC
   0EEA 9E 9E         [ 4]  506         JMP     L0E9E
   0EEC                     507 L0EEC:
   0EEC 9E B2         [ 4]  508         JMP     L0EB2
   0EEE                     509 L0EEE:
   0EEE EC 02         [ 4]  510         CMP     #0x02
   0EF0 22            [ 2]  511         BEQ     L0EF3
   0EF1 9E B2         [ 4]  512         JMP     L0EB2
   0EF3                     513 L0EF3:
   0EF3 F0            [ 4]  514         LDA     ,Y
   0EF4 ED FC         [ 4]  515         AND     #0xFC
   0EF6 EC 18         [ 4]  516         CMP     #0x18
   0EF8 42            [ 2]  517         BCC     L0EFB
   0EF9 9E 9E         [ 4]  518         JMP     L0E9E
   0EFB                     519 L0EFB:
   0EFB 9E B2         [ 4]  520         JMP     L0EB2
   0EFD                     521 L0EFD:
   0EFD C0 8C 0A      [ 5]  522         BRCLR   #0,RAM8C,L0F0A
   0F00 F0            [ 4]  523         LDA     ,Y
   0F01 ED FC         [ 4]  524         AND     #0xFC
   0F03 EC 5B         [ 4]  525         CMP     #0x5B
   0F05 42            [ 2]  526         BCC     L0F08
   0F06                     527 L0F06:
   0F06 9E B2         [ 4]  528         JMP     L0EB2
   0F08                     529 L0F08:
   0F08 9E 9E         [ 4]  530         JMP     L0E9E
   0F0A                     531 L0F0A:
   0F0A EC 02         [ 4]  532         CMP     #0x02
   0F0C 19            [ 2]  533         BNE     L0F06
   0F0D F0            [ 4]  534         LDA     ,Y
   0F0E ED FC         [ 4]  535         AND     #0xFC
   0F10 EC 18         [ 4]  536         CMP     #0x18
   0F12 42            [ 2]  537         BCC     L0F15
   0F13 9E B2         [ 4]  538         JMP     L0EB2
   0F15                     539 L0F15:
   0F15 9E 9E         [ 4]  540         JMP     L0E9E
   0F17                     541 L0F17:
   0F17 C1 82 02      [ 5]  542         BRCLR   #1,V,L0F1C
   0F1A 9F 4F         [ 4]  543         JMP     L0F4F
   0F1C                     544 L0F1C:
   0F1C F8 86         [ 4]  545         LDA     VCNT
   0F1E C3 FF 02      [ 5]  546         BRCLR   #3,A,L0F23
   0F21 9C 1B         [ 4]  547         JMP     L0C1B
   0F23                     548 L0F23:
   0F23 F8 86         [ 4]  549         LDA     VCNT
   0F25 EA 55         [ 4]  550         ADD     #0x55
   0F27 BD            [ 4]  551         STA     Y
   0F28 F0            [ 4]  552         LDA     ,Y
   0F29 F9 88         [ 4]  553         STA     RAM88
   0F2B 8F 7B         [ 4]  554         JSR     L0F7B
   0F2D B0 FE FF      [ 4]  555         MVI     TCOUNT,#0xFF
   0F30 B0 09 3F      [ 4]  556         MVI     TSTATUS,#0x3F
   0F33                     557 L0F33:
   0F33 D8 01         [ 4]  558         BSET    #0,PORTB        ; XXXX XXX1
   0F35 E8 04         [ 4]  559         LDA     #0x04
   0F37 FF FF         [ 4]  560         DEC     A
   0F39 AC            [ 4]  561         LDA     X
   0F3A D0 01         [ 4]  562         BCLR    #0,PORTB        ; XXXX XXX0
   0F3C E8 04         [ 4]  563         LDA     #0x04
   0F3E FF FF         [ 4]  564         DEC     A
   0F40 AC            [ 4]  565         LDA     X
   0F41 C7 09 EF      [ 5]  566         BRCLR   #7,TSTATUS,L0F33
   0F44 B0 FE 80      [ 4]  567         MVI     TCOUNT,#0x80
   0F47 B0 09 3F      [ 4]  568         MVI     TSTATUS,#0x3F
   0F4A                     569 L0F4A:
   0F4A C7 09 FD      [ 5]  570         BRCLR   #7,TSTATUS,L0F4A
   0F4D 9C 1B         [ 4]  571         JMP     L0C1B
   0F4F                     572 L0F4F:
   0F4F B0 80 FE      [ 4]  573         MVI     X,#0xFE         ; PB0 Low - No
   0F52 F8 86         [ 4]  574         LDA     VCNT
   0F54 EC 02         [ 4]  575         CMP     #0x02
   0F56 68            [ 2]  576         BCS     L0F5F
   0F57 24            [ 2]  577         BEQ     L0F5C
   0F58 B0 80 FB      [ 4]  578         MVI     X,#0xFB         ; PB2 Low - Not Sure
   0F5B 03            [ 2]  579         BNE     L0F5F
   0F5C                     580 L0F5C:
   0F5C B0 80 FD      [ 4]  581         MVI     X,#0xFD         ; PB1 Low - Yes
   0F5F                     582 L0F5F:
   0F5F C7 00 09      [ 5]  583         BRCLR   #7,PORTA,L0F6B  ; check mode bit
                            584 
                            585 ; mode bit is 1
   0F62 AC            [ 4]  586         LDA     X
   0F63 F9 01         [ 4]  587         STA     PORTB
   0F65 D7 01         [ 4]  588         BCLR    #7,PORTB        ; 0XXX XXXX
   0F67 DF 01         [ 4]  589         BSET    #7,PORTB        ; 1XXX XXXX
   0F69 9C 1B         [ 4]  590         JMP     L0C1B
                            591 
                            592 ; mode bit is 0
   0F6B                     593 L0F6B:
   0F6B E8 01         [ 4]  594         LDA     #0x01
   0F6D                     595 L0F6D:
   0F6D FF 86         [ 4]  596         DEC     VCNT
   0F6F CF 86 04      [ 5]  597         BRSET   #7,VCNT,L0F76
   0F72 FA FF         [ 4]  598         ADD     A
   0F74 9F 6D         [ 4]  599         JMP     L0F6D
   0F76                     600 L0F76:
   0F76 B4            [ 4]  601         COMA 
   0F77 F9 01         [ 4]  602         STA     PORTB
   0F79 9C 1B         [ 4]  603         JMP     L0C1B
                            604 
                            605 ; Middle part of special mode
                            606 ; Secret code - parameter in RAM88
                            607 
   0F7B                     608 L0F7B:
   0F7B F8 88         [ 4]  609         LDA     RAM88
                            610 
   0F7D D0 82         [ 4]  611         BCLR    #0,V
   0F7F B0 89 06      [ 4]  612         MVI     RAM89,#0x06
   0F82 B0 09 3B      [ 4]  613         MVI     TSTATUS,#0x3B
   0F85 B0 FE 82      [ 4]  614         MVI     TCOUNT,#0x82
   0F88 D7 01         [ 4]  615         BCLR    #7,PORTB        ; 0XXX XXXX
   0F8A                     616 L0F8A:
   0F8A C7 09 FD      [ 5]  617         BRCLR   #7,TSTATUS,L0F8A
   0F8D B0 FE 34      [ 4]  618         MVI     TCOUNT,#0x34
   0F90 DF 01         [ 4]  619         BSET    #7,PORTB        ; 1XXX XXXX
   0F92 D7 09         [ 4]  620         BCLR    #7,TSTATUS
   0F94                     621 L0F94:
   0F94 C7 09 FD      [ 5]  622         BRCLR   #7,TSTATUS,L0F94
   0F97                     623 L0F97:
   0F97 B0 FE 34      [ 4]  624         MVI     TCOUNT,#0x34
   0F9A F9 01         [ 4]  625         STA     PORTB           ; PPPP PPPP
   0F9C D7 09         [ 4]  626         BCLR    #7,TSTATUS
   0F9E FA FF         [ 4]  627         ADD     A
   0FA0 FF 89         [ 4]  628         DEC     RAM89      
   0FA2 22            [ 2]  629         BEQ     L0FA5
   0FA3 9F C2         [ 4]  630         JMP     L0FC2
   0FA5                     631 L0FA5:
   0FA5 C0 82 10      [ 5]  632         BRCLR   #0,V,L0FB8
   0FA8                     633 L0FA8:
   0FA8 C7 09 FD      [ 5]  634         BRCLR   #7,TSTATUS,L0FA8
   0FAB B0 01 FE      [ 4]  635         MVI     PORTB,#0xFE     ; 1111 1110
   0FAE B0 FE 40      [ 4]  636         MVI     TCOUNT,#0x40
   0FB1 B0 09 3F      [ 4]  637         MVI     TSTATUS,#0x3F   ; 
   0FB4                     638 L0FB4:
   0FB4 C7 09 FD      [ 5]  639         BRCLR   #7,TSTATUS,L0FB4
   0FB7 B3            [ 2]  640         RTS 
   0FB8                     641 L0FB8:
   0FB8 F8 88         [ 4]  642         LDA     RAM88
   0FBA B4            [ 4]  643         COMA 
   0FBB ED FC         [ 4]  644         AND     #0xFC
   0FBD B0 89 06      [ 4]  645         MVI     RAM89,#0x06
   0FC0 D8 82         [ 4]  646         BSET    #0,V
   0FC2                     647 L0FC2:
   0FC2 C7 09 FD      [ 5]  648         BRCLR   #7,TSTATUS,L0FC2
   0FC5 9F 97         [ 4]  649         JMP     L0F97
                            650 
                            651 ; Read and classify Frames?
   0FC7                     652 L0FC7:
   0FC7 B0 80 52      [ 4]  653         MVI     X,#0x52         ; X delay set to 0x52 - ~10ms frame?
   0FCA B0 09 08      [ 4]  654         MVI     TSTATUS,#0x08   ; Timer input mode, count pulses
   0FCD B0 FE 80      [ 4]  655         MVI     TCOUNT,#0x80    ; count set to 128
   0FD0 FB FF         [ 4]  656         SUB     A               ; clear A
   0FD2                     657 L0FD2:
   0FD2 C7 FE 09      [ 5]  658         BRCLR   #7,TCOUNT,L0FDE ; if we got a transition, jump
   0FD5 A9            [ 4]  659         INC     Y
   0FD6 B9            [ 4]  660         DEC     Y
   0FD7 A9            [ 4]  661         INC     Y
   0FD8 B9            [ 4]  662         DEC     Y
   0FD9 FE FF         [ 4]  663         INC     A               ; increment the running counter
   0FDB                     664 L0FDB:
   0FDB B8            [ 4]  665         DEC     X
   0FDC 15            [ 2]  666         BNE     L0FD2           ; Delay loop
   0FDD B3            [ 2]  667         RTS
   0FDE                     668 L0FDE:
   0FDE FC 5D         [ 4]  669         CMP     ROM5D           ; Compare against User Data ROM (0x02)
   0FE0 48            [ 2]  670         BCC     L0FE9           ; If >= 2, jump
   0FE1 FE 87         [ 4]  671         INC     SCNT            ; count is 0 or 1, increment SCNT
   0FE3                     672 L0FE3:
   0FE3 B0 FE 80      [ 4]  673         MVI     TCOUNT,#0x80    ; reset the transition counter
   0FE6 FB FF         [ 4]  674         SUB     A               ; clear A
   0FE8 32            [ 2]  675         BEQ     L0FDB           ; count down, loop around
   0FE9                     676 L0FE9:
   0FE9 FC 5E         [ 4]  677         CMP     ROM5E           ; Compare against User Data ROM (0x07)
   0FEB 45            [ 2]  678         BCC     L0FF1           ; if >= 7, jump
   0FEC FE 86         [ 4]  679         INC     VCNT            ; VCNT
   0FEE 14            [ 2]  680         BNE     L0FE3           ; if VCNT is not zero, loop around
   0FEF 9F DB         [ 4]  681         JMP     L0FDB           ; else count down, loop around
   0FF1                     682 L0FF1:
   0FF1 FC 5F         [ 4]  683         CMP     ROM5F           ; Compare against User Data ROM (0x18)
   0FF3 42            [ 2]  684         BCC     L0FF6           ; if >= 24, jump - too high
   0FF4 FE 85         [ 4]  685         INC     FCNT            ; FCNT
   0FF6                     686 L0FF6:
   0FF6 9F E3         [ 4]  687         JMP     L0FE3           ; 
                            688 
                            689 ; VECTORS
                            690 
   0FFC                     691         .org    0x0FFC
                            692 
   0FFC 9C 10         [ 4]  693         JMP     START           ; USER IRQ VECTOR
   0FFE 9C 10         [ 4]  694         JMP     START           ; USER RESTART VECTOR
